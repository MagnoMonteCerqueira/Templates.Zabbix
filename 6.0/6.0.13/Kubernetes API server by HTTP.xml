<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>6.0</version><date>2023-02-11T16:15:07Z</date><groups><group><uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid><name>Templates/Applications</name></group></groups><templates><template><uuid>85ce114c802e4e28a5f3597e07d07032</uuid><template>Kubernetes API server by HTTP</template><name>Kubernetes API server by HTTP</name><description>Get Kubernetes API server metrics by HTTP agent from Prometheus metrics endpoint.

Don't forget change macros {$KUBE.API.SERVER.URL}, {$KUBE.API.TOKEN}.
Some metrics may not be collected depending on your Kubernetes API server instance version and configuration.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Template tooling version used: 0.42</description><groups><group><name>Templates/Applications</name></group></groups><items><item><uuid>28944ee2c0a3478e84612cd5650f3cd5</uuid><name>Kubernetes API: Request terminations, rate</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_request_terminations</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of requests which apiserver terminated in self-defense per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_request_terminations_total</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag></tags></item><item><uuid>1ac74141a4b241b196bc47d0dee37a2c</uuid><name>Kubernetes API: API server requests: 0</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_request_total_0.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Counter of apiserver requests broken out for each HTTP response code.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_request_total{code = &quot;0&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>0</value></tag></tags></item><item><uuid>d7f8363e1bc5424f89c7386fcbe6fb06</uuid><name>Kubernetes API: API server requests: 2xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_request_total_200.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Counter of apiserver requests broken out for each HTTP response code.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_request_total{code =~ &quot;2..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>2xx</value></tag></tags></item><item><uuid>453852b621ca4a7cbc4d80e5327c80da</uuid><name>Kubernetes API: API server requests: 3xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_request_total_300.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Counter of apiserver requests broken out for each HTTP response code.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_request_total{code =~ &quot;3..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>3xx</value></tag></tags></item><item><uuid>1f72779899f94620bc55870f5e2c2ca0</uuid><name>Kubernetes API: API server requests: 4xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_request_total_400.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Counter of apiserver requests broken out for each HTTP response code.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_request_total{code =~ &quot;4..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>4xx</value></tag></tags></item><item><uuid>1c24d58b28bc423e868a965d689cf146</uuid><name>Kubernetes API: API server requests: 5xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_request_total_500.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Counter of apiserver requests broken out for each HTTP response code.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_request_total{code =~ &quot;5..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>5xx</value></tag></tags><triggers><trigger><uuid>0e1ef1630b5d4cb98270564f324f5382</uuid><expression>min(/Kubernetes API server by HTTP/kubernetes.api.apiserver_request_total_500.rate,5m)&gt;{$KUBE.API.HTTP.SERVER.ERROR}</expression><name>Kubernetes API: Too many server errors</name><event_name>Kubernetes API: Too many server errors (over {$KUBE.API.HTTP.SERVER.ERROR} for 5m)</event_name><priority>WARNING</priority><description>&quot;Kubernetes API server is experiencing high error rate (with 5xx HTTP code).</description><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item><item><uuid>5bd8b2deaf1142369ba67afc7a41ab11</uuid><name>Kubernetes API: TLS handshake errors, rate</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_tls_handshake_errors_total.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of requests dropped with 'TLS handshake error from' error per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_tls_handshake_errors_total</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>tls</value></tag></tags></item><item><uuid>54723f57a20a47a698fbf47cbec0f7a1</uuid><name>Kubernetes API: Audit events, total</name><type>DEPENDENT</type><key>kubernetes.api.audit_event_total</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Accumulated number audit events generated and sent to the audit backend.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_audit_event_total</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>audit</value></tag></tags></item><item><uuid>de87284b8bd644398e4a88a064e206bb</uuid><name>Kubernetes API: CPU</name><type>DEPENDENT</type><key>kubernetes.api.cpu.util</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>%</units><description>Total user and system CPU usage ratio.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_cpu_seconds_total</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step><step><type>MULTIPLIER</type><parameters><parameter>100</parameter></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cpu</value></tag></tags></item><item><uuid>e4e3c570a55a48689c145c4a2310c597</uuid><name>Kubernetes API: Get API instance metrics</name><type>HTTP_AGENT</type><key>kubernetes.api.get_metrics</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Get raw metrics from API instance /metrics endpoint.</description><preprocessing><step><type>CHECK_NOT_SUPPORTED</type><parameters><parameter/></parameters></step></preprocessing><timeout>15s</timeout><url>{$KUBE.API.SERVER.URL}</url><headers><header><name>Authorization</name><value>Bearer {$KUBE.API.TOKEN}</value></header></headers><tags><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>79db985ac8f645999fe8aa73b4073bfb</uuid><name>Kubernetes API: Goroutines</name><type>DEPENDENT</type><key>kubernetes.api.go_goroutines</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of goroutines that currently exist.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>go_goroutines</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>goroutines</value></tag></tags></item><item><uuid>2022d65c2f7a4f07bc1cba435a2be1e9</uuid><name>Kubernetes API: Go threads</name><type>DEPENDENT</type><key>kubernetes.api.go_threads</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of OS threads created.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>go_threads</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>go-threads</value></tag></tags></item><item><uuid>837c546cb3bc400ab7a62a672792f88b</uuid><name>Kubernetes API: gRPCs messages ressived, rate</name><type>DEPENDENT</type><key>kubernetes.api.grpc_client_msg_received.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of gRPC stream messages received per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>grpc_client_msg_received_total</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>grpc</value></tag></tags></item><item><uuid>353559f3b9684647a74bd429d80731b9</uuid><name>Kubernetes API: gRPCs messages sent, rate</name><type>DEPENDENT</type><key>kubernetes.api.grpc_client_msg_sent.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of gRPC stream messages sent per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>grpc_client_msg_sent_total</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>grpc</value></tag></tags></item><item><uuid>0850afe759684950be79135ed4f32c79</uuid><name>Kubernetes API: gRPCs client started, rate</name><type>DEPENDENT</type><key>kubernetes.api.grpc_client_started.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of RPCs started per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>grpc_client_started_total</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>grpc</value></tag></tags></item><item><uuid>187702b1c3a24d07aaf9cc07fa359095</uuid><name>Kubernetes API: Fds max</name><type>DEPENDENT</type><key>kubernetes.api.max_fds</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Maximum allowed open file descriptors.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_max_fds</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>fds</value></tag></tags></item><item><uuid>41f802305a234b1ab9fb0e89d1e40290</uuid><name>Kubernetes API: Fds open</name><type>DEPENDENT</type><key>kubernetes.api.open_fds</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of open file descriptors.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_open_fds</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>fds</value></tag></tags></item><item><uuid>53fd5211b6da47d3b3fc87ab8a2d0c33</uuid><name>Kubernetes API: Resident memory, bytes</name><type>DEPENDENT</type><key>kubernetes.api.process_resident_memory_bytes</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>B</units><description>Resident memory size in bytes.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_resident_memory_bytes</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>memory</value></tag></tags></item><item><uuid>010a983426c9407eb4b6bf7822b411ce</uuid><name>Kubernetes API: Virtual memory, bytes</name><type>DEPENDENT</type><key>kubernetes.api.process_virtual_memory_bytes</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>B</units><description>Virtual memory size in bytes.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_virtual_memory_bytes</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>memory</value></tag></tags></item><item><uuid>3f15d60ef7cb4a068424d5835d04a817</uuid><name>Kubernetes API: HTTP requests: 2xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.rest_client_requests_total_200.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 2xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;2..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>2xx</value></tag></tags></item><item><uuid>450607dda045428fb6d4a96ca8888c19</uuid><name>Kubernetes API: HTTP requests: 3xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.rest_client_requests_total_300.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 3xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;3..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>3xx</value></tag></tags></item><item><uuid>f11b87e0bc5a41ff956391b6cb7115c5</uuid><name>Kubernetes API: HTTP requests: 4xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.rest_client_requests_total_400.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 4xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;4..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>4xx</value></tag></tags></item><item><uuid>2588c2332fea48f8bae414e8b7c42184</uuid><name>Kubernetes API: HTTP requests: 5xx, rate</name><type>DEPENDENT</type><key>kubernetes.api.rest_client_requests_total_500.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 5xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;5..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>http-code</tag><value>5xx</value></tag></tags><triggers><trigger><uuid>4c79888da91448738092c86e5f427a6a</uuid><expression>min(/Kubernetes API server by HTTP/kubernetes.api.rest_client_requests_total_500.rate,5m)&gt;{$KUBE.API.HTTP.CLIENT.ERROR}</expression><name>Kubernetes API: Too many client errors</name><event_name>Kubernetes API: Too many client errors (over {$KUBE.API.HTTP.CLIENT.ERROR} for 5m)</event_name><priority>WARNING</priority><description>&quot;Kubernetes API client is experiencing high error rate (with 5xx HTTP code).</description><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item></items><discovery_rules><discovery_rule><uuid>22c5e2a84d9542c1905d0c20f4ca6700</uuid><name>Watchers metrics discovery</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_registered_watchers.discovery</key><delay>0</delay><description>Discovery watchers by kind.</description><item_prototypes><item_prototype><uuid>09d0815f893c42c1b95721f7f908940a</uuid><name>Kubernetes API: Watchers: {#KIND}</name><type>DEPENDENT</type><key>kubernetes.api.apiserver_registered_watchers[&quot;{#KIND}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of currently registered watchers for a given resource.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_registered_watchers{kind = &quot;{#KIND}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>watchers</value></tag><tag><tag>kind</tag><value>{#KIND}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>apiserver_registered_watchers{kind =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var kind = item.labels.kind;
    if (!(lookup[kind])) {
        lookup[kind] = 1;
        result.push({ '{#KIND}': kind });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>45ad0dd7331d4b9391d26b78838b0433</uuid><name>Authentication requests discovery</name><type>DEPENDENT</type><key>kubernetes.api.authenticated_user_requests.discovery</key><delay>0</delay><description>Discovery authentication attempts by name.</description><item_prototypes><item_prototype><uuid>6950d30d0b1d4162acee45f184453fbd</uuid><name>Kubernetes API: Authenticated requests: {#NAME}, rate</name><type>DEPENDENT</type><key>kubernetes.api.authenticated_user_requests.rate[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Counter of authenticated requests broken out by username per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>authenticated_user_requests{result = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>authentication</value></tag><tag><tag>name</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>authenticated_user_requests{username =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var name = item.labels.username;
    if (!(lookup[result])) {
        lookup[name] = 1;
        result.push({ '{#NAME}': name });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>ca23c310c71f4e88891ceae883527389</uuid><name>Authentication attempts discovery</name><type>DEPENDENT</type><key>kubernetes.api.authentication_attempts.discovery</key><delay>0</delay><description>Discovery authentication attempts by result.</description><item_prototypes><item_prototype><uuid>d9ddaa016a7c4ca381fbe857959dd0fd</uuid><name>Kubernetes API: Authentication attempts: {#RESULT}, rate</name><type>DEPENDENT</type><key>kubernetes.api.authentication_attempts.rate[&quot;{#RESULT}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Authentication attempts by result per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>authentication_attempts{result = &quot;{#RESULT}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>authentication</value></tag><tag><tag>result</tag><value>{#RESULT}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>authentication_attempts{result =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var result_api = item.labels.result;
    if (!(lookup[result])) {
        lookup[result_api] = 1;
        result.push({ '{#RESULT}': result_api });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>0821009ea3be43e089247e843723577f</uuid><name>Client certificate expiration histogram</name><type>DEPENDENT</type><key>kubernetes.api.certificate_expiration.discovery</key><delay>0</delay><description>Discovery raw data of client certificate expiration</description><item_prototypes><item_prototype><uuid>b69600f22c7b42b48f8601ada06a5a9f</uuid><name>Kubernetes API: Client certificate expiration, p1</name><type>CALCULATED</type><key>kubernetes.api.client_certificate_expiration_p1[{#SINGLETON}]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.api.client_certificate_expiration_seconds_bucket[*],5m,1)</params><description>1 percentile of the remaining lifetime on the certificate used to authenticate a request.</description><tags><tag><tag>component</tag><value>client-certificate</value></tag></tags><trigger_prototypes><trigger_prototype><uuid>1371958c0339430b8a333851766c01c0</uuid><expression>last(/Kubernetes API server by HTTP/kubernetes.api.client_certificate_expiration_p1[{#SINGLETON}]) &gt; 0 and last(/Kubernetes API server by HTTP/kubernetes.api.client_certificate_expiration_p1[{#SINGLETON}]) &lt; 24*60*60</expression><name>Kubernetes API: Kubernetes client certificate expires soon</name><priority>WARNING</priority><description>A client certificate used to authenticate to the apiserver is expiring in less than 24.0 hours.</description><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype><trigger_prototype><uuid>132d58724bd141afa3f28101326fe922</uuid><expression>last(/Kubernetes API server by HTTP/kubernetes.api.client_certificate_expiration_p1[{#SINGLETON}]) &gt; 0 and last(/Kubernetes API server by HTTP/kubernetes.api.client_certificate_expiration_p1[{#SINGLETON}]) &lt; {$KUBE.API.CERT.EXPIRATION}*24*60*60</expression><name>Kubernetes API: Kubernetes client certificate is expiring</name><event_name>Kubernetes API: Kubernetes client certificate expires in {$KUBE.API.CERT.EXPIRATION} days</event_name><priority>WARNING</priority><description>A client certificate used to authenticate to the apiserver is expiring in {$KUBE.API.CERT.EXPIRATION} days.</description><dependencies><dependency><name>Kubernetes API: Kubernetes client certificate expires soon</name><expression>last(/Kubernetes API server by HTTP/kubernetes.api.client_certificate_expiration_p1[{#SINGLETON}]) &gt; 0 and last(/Kubernetes API server by HTTP/kubernetes.api.client_certificate_expiration_p1[{#SINGLETON}]) &lt; 24*60*60</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><uuid>860cc40806254564bddb3617b8b75e74</uuid><name>Kubernetes API: Certificate expiration seconds bucket, {#LE}</name><type>DEPENDENT</type><key>kubernetes.api.client_certificate_expiration_seconds_bucket[{#LE}]</key><delay>0</delay><history>1h</history><trends>0</trends><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><description>Distribution of the remaining lifetime on the certificate used to authenticate a request.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_client_certificate_expiration_seconds_bucket{le = &quot;{#LE}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>client-certificate</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>{__name__=~ &quot;apiserver_client_certificate_expiration_seconds_*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    if (item.name === &quot;apiserver_client_certificate_expiration_seconds_count&quot;){
        result.push({
            '{#TYPE}': 'totals',
            '{#SINGLETON}': ''
        });

      }
    else if  (item.name === &quot;apiserver_client_certificate_expiration_seconds_bucket&quot;){
        result.push({
            '{#TYPE}': 'buckets',
            '{#LE}': item.labels.le
        });
    }
});

return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><overrides><override><name>bucket item</name><step>1</step><filter><conditions><condition><macro>{#TYPE}</macro><value>buckets</value><formulaid>A</formulaid></condition></conditions></filter><operations><operation><operationobject>ITEM_PROTOTYPE</operationobject><operator>LIKE</operator><value>bucket</value><status>ENABLED</status><discover>DISCOVER</discover></operation></operations></override><override><name>total item</name><step>2</step><filter><conditions><condition><macro>{#TYPE}</macro><value>totals</value><formulaid>A</formulaid></condition></conditions></filter><operations><operation><operationobject>ITEM_PROTOTYPE</operationobject><operator>NOT_LIKE</operator><value>bucket</value><status>ENABLED</status><discover>DISCOVER</discover></operation></operations></override></overrides></discovery_rule><discovery_rule><uuid>8dcd7c95a9364efdb2fe64c651360ad4</uuid><name>Etcd objects metrics discovery</name><type>DEPENDENT</type><key>kubernetes.api.etcd_object_counts.discovery</key><delay>0</delay><description>Discovery etcd objects by resource.</description><item_prototypes><item_prototype><uuid>75c15b57189d4cbeb6ed6397fc377e2a</uuid><name>Kubernetes API: etcd objects: {#RESOURCE}</name><type>DEPENDENT</type><key>kubernetes.api.etcd_object_counts[&quot;{#RESOURCE}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of stored objects at the time of last check split by kind.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>etcd_object_counts{ resource = &quot;{#RESOURCE}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>etcd</value></tag><tag><tag>resource</tag><value>{#RESOURCE}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>etcd_object_counts{resource =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var resource = item.labels.resource;
    if (!(lookup[resource])) {
        lookup[resource] = 1;
        result.push({ '{#RESOURCE}': resource });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>099e6ff46075457cba6b669a5880ceef</uuid><name>gRPC completed requests discovery</name><type>DEPENDENT</type><key>kubernetes.api.grpc_client_handled.discovery</key><delay>0</delay><description>Discovery grpc completed requests by grpc code.</description><item_prototypes><item_prototype><uuid>690dc00ad92d44d0b9bc7db58c07bd8f</uuid><name>Kubernetes API: gRPCs completed: {#GRPC_CODE}, rate</name><type>DEPENDENT</type><key>kubernetes.api.grpc_client_handled_total.rate[&quot;{#GRPC_CODE}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of RPCs completed by the client regardless of success or failure per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>grpc_client_handled_total{grpc_code = &quot;{#GRPC_CODE}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>grpc</value></tag><tag><tag>grpc-code</tag><value>{#GRPC_CODE}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>grpc_client_handled_total{grpc_code =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var grpc_code = item.labels.grpc_code;
    if (!(lookup[grpc_code])) {
        lookup[grpc_code] = 1;
        result.push({ '{#GRPC_CODE}': grpc_code });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>948e1d84d44642a78f59c92271a21a68</uuid><name>Requests inflight discovery</name><type>DEPENDENT</type><key>kubernetes.api.inflight_requests.discovery</key><delay>0</delay><description>Discovery requests inflight by kind.</description><item_prototypes><item_prototype><uuid>5076679154cc464ebab0b678f65c8853</uuid><name>Kubernetes API: Requests current: {#KIND}</name><type>DEPENDENT</type><key>kubernetes.api.current_inflight_requests[&quot;{#KIND}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Maximal number of currently used inflight request limit of this apiserver per request kind in last second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_current_inflight_requests{request_kind = &quot;{#KIND}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>kind</tag><value>{#KIND}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>apiserver_current_inflight_requests{request_kind =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var request_kind = item.labels.request_kind;
    if (!(lookup[request_kind])) {
        lookup[request_kind] = 1;
        result.push({ '{#KIND}': request_kind });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>7cd3ef5e2c874db18088b3531c944b25</uuid><name>Long-running requests</name><type>DEPENDENT</type><key>kubernetes.api.longrunning_gauge.discovery</key><delay>0</delay><description>Discovery of long-running requests by verb, resource and scope.</description><item_prototypes><item_prototype><uuid>feee53d3fc69401ba359ecd97788e552</uuid><name>Kubernetes API: Long-running [&quot;{#VERB}&quot;] requests [&quot;{#RESOURCE}&quot;]: {#SCOPE}</name><type>DEPENDENT</type><key>kubernetes.api.longrunning_gauge[&quot;{#RESOURCE}&quot;,&quot;{#SCOPE}&quot;,&quot;{#VERB}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Gauge of all active long-running apiserver requests broken out by verb, resource and scope. Not all requests are tracked this way.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_longrunning_gauge{resource = &quot;{#RESOURCE}&quot;, scope = &quot;{#SCOPE}&quot;, verb = &quot;{#VERB}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>resource</tag><value>{#RESOURCE}</value></tag><tag><tag>scope</tag><value>{#SCOPE}</value></tag><tag><tag>verb</tag><value>{#VERB}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>apiserver_longrunning_gauge{resource =~ &quot;.*&quot;, scope =~ &quot;.*&quot;, verb =~ &quot;.*&quot;}</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var request_kind = item.labels.resource + item.labels.scope + item.labels.verb;
    if (!(lookup[request_kind])) {
        lookup[request_kind] = 1;
        result.push({
            '{#RESOURCE}': item.labels.resource,
            '{#SCOPE}': item.labels.scope,
            '{#VERB}': item.labels.verb
        });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>7c5ffdbafc5e4e349cc62ed0d0c0f20f</uuid><name>Request duration histogram</name><type>DEPENDENT</type><key>kubernetes.api.requests_bucket.discovery</key><delay>0</delay><description>Discovery raw data and percentile items of request duration.</description><item_prototypes><item_prototype><uuid>5135a1bc92514c79965edea9d7d2a47e</uuid><name>Kubernetes API: [&quot;{#VERB}&quot;] Requests bucket: {#LE}</name><type>DEPENDENT</type><key>kubernetes.api.request_duration_seconds_bucket[{#LE},&quot;{#VERB}&quot;]</key><delay>0</delay><history>1h</history><trends>0</trends><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><description>Response latency distribution in seconds for each verb.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>apiserver_request_duration_seconds_bucket{le=&quot;{#LE}&quot;,verb=&quot;{#VERB}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>verb</tag><value>{#VERB}</value></tag></tags></item_prototype><item_prototype><uuid>a4f39bb87ef248edbb578c0c89baba46</uuid><name>Kubernetes API: [&quot;{#VERB}&quot;] Requests, p50</name><type>CALCULATED</type><key>kubernetes.api.request_duration_seconds_p50[&quot;{#VERB}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.api.request_duration_seconds_bucket[*,&quot;{#VERB}&quot;],5m,50)</params><description>50 percentile of response latency distribution in seconds for each verb.</description><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>verb</tag><value>{#VERB}</value></tag></tags></item_prototype><item_prototype><uuid>12d65aff584e459586284967e570fc0a</uuid><name>Kubernetes API: [&quot;{#VERB}&quot;] Requests, p90</name><type>CALCULATED</type><key>kubernetes.api.request_duration_seconds_p90[&quot;{#VERB}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.api.request_duration_seconds_bucket[*,&quot;{#VERB}&quot;],5m,90)</params><description>90 percentile of response latency distribution in seconds for each verb.</description><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>verb</tag><value>{#VERB}</value></tag></tags></item_prototype><item_prototype><uuid>3e900f1e4cab4edba4d068f1b6759428</uuid><name>Kubernetes API: [&quot;{#VERB}&quot;] Requests, p95</name><type>CALCULATED</type><key>kubernetes.api.request_duration_seconds_p95[&quot;{#VERB}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.api.request_duration_seconds_bucket[*,&quot;{#VERB}&quot;],5m,95)</params><description>95 percentile of response latency distribution in seconds for each verb.</description><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>verb</tag><value>{#VERB}</value></tag></tags></item_prototype><item_prototype><uuid>a34c3c5f5f844c46a4d3f148cacd3fd3</uuid><name>Kubernetes API: [&quot;{#VERB}&quot;] Requests, p99</name><type>CALCULATED</type><key>kubernetes.api.request_duration_seconds_p99[&quot;{#VERB}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.api.request_duration_seconds_bucket[*,&quot;{#VERB}&quot;],5m,99)</params><description>99 percentile of response latency distribution in seconds for each verb.</description><tags><tag><tag>component</tag><value>requests</value></tag><tag><tag>verb</tag><value>{#VERB}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>a974cb068f184b7385bf5eb2e4ba084a</uuid><name>Kubernetes API: [&quot;{#VERB}&quot;] Requests latency</name><graph_items><graph_item><color>1A7C11</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.request_duration_seconds_p90[&quot;{#VERB}&quot;]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.request_duration_seconds_p95[&quot;{#VERB}&quot;]</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.request_duration_seconds_p99[&quot;{#VERB}&quot;]</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.request_duration_seconds_p50[&quot;{#VERB}&quot;]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>{__name__=~ &quot;apiserver_request_duration_*&quot;, verb =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    lookup_histogram = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    if (item.name === 'apiserver_request_duration_seconds_count') {
        var label_verb = item.labels.verb;
        if (lookup[label_verb]) {
            return;
        }
        lookup[label_verb] = 1;
        result.push({
            '{#TYPE}': 'totals',
            '{#VERB}': label_verb
        });

      }
    else if  (item.name === 'apiserver_request_duration_seconds_bucket') {
        var labels = item.labels.verb + item.labels.le;

        if (lookup_histogram[labels]) {
            return;
        }

        lookup_histogram[labels] = 1;
        result.push({
            '{#TYPE}': 'buckets',
            '{#VERB}': item.labels.verb,
            '{#LE}': item.labels.le
        });
    }
});

return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><overrides><override><name>bucket item</name><step>1</step><filter><conditions><condition><macro>{#TYPE}</macro><value>buckets</value><formulaid>A</formulaid></condition></conditions></filter><operations><operation><operationobject>ITEM_PROTOTYPE</operationobject><operator>LIKE</operator><value>bucket</value><status>ENABLED</status><discover>DISCOVER</discover></operation></operations></override><override><name>total item</name><step>2</step><filter><conditions><condition><macro>{#TYPE}</macro><value>totals</value><formulaid>A</formulaid></condition></conditions></filter><operations><operation><operationobject>ITEM_PROTOTYPE</operationobject><operator>NOT_LIKE</operator><value>bucket</value><status>ENABLED</status><discover>DISCOVER</discover></operation></operations></override></overrides></discovery_rule><discovery_rule><uuid>d015cafd6e9f4707bb78125ff17cc679</uuid><name>Workqueue metrics discovery</name><type>DEPENDENT</type><key>kubernetes.api.workqueue.discovery</key><delay>0</delay><description>Discovery workqueue metrics by name.</description><item_prototypes><item_prototype><uuid>cf58e773a5684eafa74b56ed43490148</uuid><name>Kubernetes API: [&quot;{#NAME}&quot;] Workqueue adds total, rate</name><type>DEPENDENT</type><key>kubernetes.api.workqueue_adds_total.rate[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of adds handled by workqueue per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_adds_total{name = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>4fe45ff01cdf4bdf85e74a52d2d3b917</uuid><name>Kubernetes API: [&quot;{#NAME}&quot;] Workqueue depth</name><type>DEPENDENT</type><key>kubernetes.api.workqueue_depth[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Current depth of workqueue.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_depth{name = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.api.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><master_item><key>kubernetes.api.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>workqueue_adds_total{name =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    var name = item.labels.name;
    if (!(lookup[name])) {
        lookup[name] = 1;
        result.push({ '{#NAME}': name });
    }
});
return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule></discovery_rules><tags><tag><tag>class</tag><value>software</value></tag><tag><tag>target</tag><value>kubernetes api server</value></tag></tags><macros><macro><macro>{$KUBE.API.CERT.EXPIRATION}</macro><value>7</value><description>Number of days for alert of client certificate used for trigger</description></macro><macro><macro>{$KUBE.API.HTTP.CLIENT.ERROR}</macro><value>2</value><description>Maximum number of HTTP client requests failures used for trigger</description></macro><macro><macro>{$KUBE.API.HTTP.SERVER.ERROR}</macro><value>2</value><description>Maximum number of HTTP client requests failures used for trigger</description></macro><macro><macro>{$KUBE.API.SERVER.URL}</macro><value>http://localhost:8086/metrics</value><description>instance URL</description></macro><macro><macro>{$KUBE.API.TOKEN}</macro><description>API Authorization Token</description></macro></macros></template></templates><graphs><graph><uuid>749ed49ec625449db0a345d639f7d8fd</uuid><name>Kubernetes API: HTTP requests rate</name><graph_items><graph_item><color>1A7C11</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.apiserver_request_total_200.rate</key></item></graph_item><graph_item><color>1A7C11</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.rest_client_requests_total_200.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.apiserver_request_total_300.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.rest_client_requests_total_300.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.apiserver_request_total_400.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.rest_client_requests_total_400.rate</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.apiserver_request_total_500.rate</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.rest_client_requests_total_500.rate</key></item></graph_item><graph_item><sortorder>4</sortorder><color>FC6EA3</color><item><host>Kubernetes API server by HTTP</host><key>kubernetes.api.apiserver_request_total_0.rate</key></item></graph_item></graph_items></graph></graphs></zabbix_export>
