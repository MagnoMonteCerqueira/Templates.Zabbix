<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>6.0</version><date>2023-02-11T16:15:09Z</date><groups><group><uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid><name>Templates/Applications</name></group></groups><templates><template><uuid>0368ca599bbb49729587b9c43ac83084</uuid><template>Envoy Proxy by HTTP</template><name>Envoy Proxy by HTTP</name><description>Get Envoy Proxy metrics by HTTP agent from metrics endpoint.
https://www.envoyproxy.io/docs/envoy/v1.20.0/operations/stats_overview

Don't forget to change macros {$ENVOY.URL}, {$ENVOY.METRICS.PATH}.
Some metrics may not be collected depending on your Envoy Proxy instance version and configuration.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Template tooling version used: 0.41</description><groups><group><name>Templates/Applications</name></group></groups><items><item><uuid>c5c90eeb0c424cc8ade0b795f2c1bb45</uuid><name>Envoy Proxy: Clusters, active</name><type>DEPENDENT</type><key>envoy.cluster_manager.active_clusters</key><delay>0</delay><history>7d</history><description>Number of currently active (warmed) clusters.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_manager_active_clusters</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cluster</value></tag></tags></item><item><uuid>f994b20217444723b6a1aad5b9a07cd0</uuid><name>Envoy Proxy: Clusters, added rate</name><type>DEPENDENT</type><key>envoy.cluster_manager.cluster_added.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total clusters added (either via static config or CDS) per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_manager_cluster_added</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cluster</value></tag></tags></item><item><uuid>0286c5deba924ce8b79e3b1f6c9e033c</uuid><name>Envoy Proxy: Clusters, modified rate</name><type>DEPENDENT</type><key>envoy.cluster_manager.cluster_modified.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total clusters modified (via CDS) per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_manager_cluster_modified</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cluster</value></tag></tags></item><item><uuid>5c3475b88a044d0bb779a3ee455d2618</uuid><name>Envoy Proxy: Clusters, removed rate</name><type>DEPENDENT</type><key>envoy.cluster_manager.cluster_removed.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total clusters removed (via CDS) per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_manager_cluster_removed</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cluster</value></tag></tags></item><item><uuid>9bb29e3b322e40c3aaa14f2e0911cc68</uuid><name>Envoy Proxy: Clusters, updates rate</name><type>DEPENDENT</type><key>envoy.cluster_manager.cluster_updated.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total cluster updates per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_manager_cluster_updated</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cluster</value></tag></tags></item><item><uuid>9c3503fc553a409ab897f287b882f055</uuid><name>Envoy Proxy: Clusters, warming</name><type>DEPENDENT</type><key>envoy.cluster_manager.warming_clusters</key><delay>0</delay><history>7d</history><description>Number of currently warming (not active) clusters.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_manager_warming_clusters</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cluster</value></tag></tags></item><item><uuid>cc10052300624df3bf869279dd5e7b49</uuid><name>Envoy Proxy: Filesystem, flushed by timer rate</name><type>DEPENDENT</type><key>envoy.filesystem.flushed_by_timer.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of times internal flush buffers are written to a file due to flush timeout per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_filesystem_flushed_by_timer</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>filesystem</value></tag></tags></item><item><uuid>b3c050dd60d44c0599bc44c9a21621d9</uuid><name>Envoy Proxy: Filesystem, reopen failed rate</name><type>DEPENDENT</type><key>envoy.filesystem.reopen_failed.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of times a file was failed to be opened per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_filesystem_reopen_failed</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>filesystem</value></tag></tags></item><item><uuid>2f400ee513c841f6b7a4fa48834f4a9c</uuid><name>Envoy Proxy: Filesystem, write completed rate</name><type>DEPENDENT</type><key>envoy.filesystem.write_completed.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of times a file was written per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_filesystem_write_completed</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>filesystem</value></tag></tags></item><item><uuid>ae48575f37494e0e9ccfa2c390f5bf68</uuid><name>Envoy Proxy: Filesystem, write failed rate</name><type>DEPENDENT</type><key>envoy.filesystem.write_failed.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total number of times an error occurred during a file write operation per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_filesystem_write_failed</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>filesystem</value></tag></tags></item><item><uuid>c6baf4c4e99f4516a23f87c089252a82</uuid><name>Envoy Proxy: Get node metrics</name><type>HTTP_AGENT</type><key>envoy.get_metrics</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Get server metrics.</description><preprocessing><step><type>CHECK_NOT_SUPPORTED</type><parameters><parameter/></parameters></step></preprocessing><url>{$ENVOY.URL}{$ENVOY.METRICS.PATH}</url><tags><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>579f47037749460e974433ef6cfe3202</uuid><name>Envoy Proxy: Listeners, added</name><type>DEPENDENT</type><key>envoy.listener_manager.listener_added.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total listeners added (either via static config or LDS) per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_listener_added</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag></tags></item><item><uuid>a259d191fcce48458a9f671a1a2dd6aa</uuid><name>Envoy Proxy: Listeners, create failure</name><type>DEPENDENT</type><key>envoy.listener_manager.listener_create_failure.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total failed listener object additions to workers per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_listener_create_failure</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag></tags></item><item><uuid>c036b55d5aea45f9b0e9c44ea279e2ed</uuid><name>Envoy Proxy: Listeners, create success</name><type>DEPENDENT</type><key>envoy.listener_manager.listener_create_success.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total listener objects successfully added to workers per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_listener_create_success</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag></tags></item><item><uuid>b217c7aaa415495089d079a2f81ead2d</uuid><name>Envoy Proxy: Listeners, stopped</name><type>DEPENDENT</type><key>envoy.listener_manager.listener_stopped.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total listeners stopped per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_listener_stopped</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag></tags></item><item><uuid>7ba3e4be89514d53b8ebaad8e9ba58d0</uuid><name>Envoy Proxy: Listeners, active</name><type>DEPENDENT</type><key>envoy.listener_manager.total_listeners_active</key><delay>0</delay><history>7d</history><description>Number of currently active listeners.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_total_listeners_active</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag></tags></item><item><uuid>f01f1236cd1a4661b67633836a61537e</uuid><name>Envoy Proxy: Listeners, draining</name><type>DEPENDENT</type><key>envoy.listener_manager.total_listeners_draining</key><delay>0</delay><history>7d</history><description>Number of currently draining listeners.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_total_listeners_draining</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag></tags></item><item><uuid>a1a01a7df5364a098fdf96b9de20558d</uuid><name>Envoy Proxy: Listener, warming</name><type>DEPENDENT</type><key>envoy.listener_manager.total_listeners_warming</key><delay>0</delay><history>7d</history><description>Number of currently warming listeners.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_total_listeners_warming</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag></tags></item><item><uuid>feeab802ed9a44559ded48ea67aba23e</uuid><name>Envoy Proxy: Listener manager, initialized</name><type>DEPENDENT</type><key>envoy.listener_manager.workers_started</key><delay>0</delay><history>7d</history><description>A boolean (1 if started and 0 otherwise) that indicates whether listeners have been initialized on workers.</description><valuemap><name>Envoy listener manager</name></valuemap><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_manager_workers_started</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener-manager</value></tag></tags></item><item><uuid>b8e3b2a5614e4460abe10be443641621</uuid><name>Envoy Proxy: Server concurrency</name><type>DEPENDENT</type><key>envoy.server.concurrency</key><delay>0</delay><history>7d</history><description>Number of worker threads.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_concurrency</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>application</value></tag></tags></item><item><uuid>91cbea325a634d8a8fc256782a7e004d</uuid><name>Envoy Proxy: Certificate expiration, day before</name><type>DEPENDENT</type><key>envoy.server.days_until_first_cert_expiring</key><delay>0</delay><history>7d</history><units>!Days</units><description>Number of days until the next certificate being managed will expire.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_days_until_first_cert_expiring</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>certificate</value></tag></tags><triggers><trigger><uuid>d025e1c521ee4f53acd896d96609beec</uuid><expression>last(/Envoy Proxy by HTTP/envoy.server.days_until_first_cert_expiring)&lt;{$ENVOY.CERT.MIN}</expression><name>Envoy Proxy: SSL certificate expires soon</name><event_name>Envoy Proxy: SSL certificate expires soon (less than {$CERT.EXPIRY.MIN} days)</event_name><opdata>Expires: {ITEM.VALUE}</opdata><priority>WARNING</priority><description>Please check certificate. Less than {$ENVOY.CERT.MIN} days left until the next certificate being managed will expire.</description><tags><tag><tag>scope</tag><value>security</value></tag></tags></trigger></triggers></item><item><uuid>d8fc1e89c2e14f5e86ea1378fee22a0b</uuid><name>Envoy Proxy: Server live</name><type>DEPENDENT</type><key>envoy.server.live</key><delay>0</delay><history>7d</history><description>1 if the server is not currently draining, 0 otherwise.</description><valuemap><name>Envoy server live</name></valuemap><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_live</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>health</value></tag></tags></item><item><uuid>4b50974e6b7444c8a47da589239247a9</uuid><name>Envoy Proxy: Memory allocated</name><type>DEPENDENT</type><key>envoy.server.memory_allocated</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>B</units><description>Current amount of allocated memory in bytes. Total of both new and old Envoy processes on hot restart.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_memory_allocated</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>memory</value></tag></tags></item><item><uuid>05b2fe80bbc54b58b19166c921ba244a</uuid><name>Envoy Proxy: Memory heap size</name><type>DEPENDENT</type><key>envoy.server.memory_heap_size</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>B</units><description>Current reserved heap size in bytes. New Envoy process heap size on hot restart.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_memory_heap_size</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>memory</value></tag></tags></item><item><uuid>a1842c747e5b44a39746037b3f844f4f</uuid><name>Envoy Proxy: Memory physical size</name><type>DEPENDENT</type><key>envoy.server.memory_physical_size</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>B</units><description>Current estimate of total bytes of the physical memory. New Envoy process physical memory size on hot restart.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_memory_physical_size</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>memory</value></tag></tags></item><item><uuid>a13b35ef1e9f4697953a935239b146d9</uuid><name>Envoy Proxy: Connections, parent</name><type>DEPENDENT</type><key>envoy.server.parent_connections</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total connections of the old Envoy process on hot restart.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_parent_connections</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>701e69bdd408408c8b516e130ed31725</uuid><name>Envoy Proxy: Server state</name><type>DEPENDENT</type><key>envoy.server.state</key><delay>0</delay><history>7d</history><description>State of the server.
Live - (default) ⁣Server is live and serving traffic.
Draining - ⁣Server is draining listeners in response to external health checks failing.
Pre initializing - ⁣Server has not yet completed cluster manager initialization.
Initializing - Server is running the cluster manager initialization callbacks (e.g., RDS).</description><valuemap><name>Envoy server state</name></valuemap><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_state</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>health</value></tag></tags><triggers><trigger><uuid>b90a6241e1294fdc8502426b7582c1c2</uuid><expression>last(/Envoy Proxy by HTTP/envoy.server.state) &gt; 0</expression><name>Envoy Proxy: Server state is not live</name><opdata>Current state: {ITEM.LASTVALUE1}</opdata><priority>AVERAGE</priority><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item><item><uuid>8b2f3702af20404aa1c75498098aff02</uuid><name>Envoy Proxy: Connections, total</name><type>DEPENDENT</type><key>envoy.server.total_connections</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total connections of both new and old Envoy processes.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_total_connections</parameter><parameter>value</parameter><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>ee3c3a89aed34257999e6106fddbc8a4</uuid><name>Envoy Proxy: Uptime</name><type>DEPENDENT</type><key>envoy.server.uptime</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>s</units><description>Current server uptime in seconds.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_server_uptime</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>application</value></tag></tags><triggers><trigger><uuid>173c90200dd1451db10b8ea8b018bc54</uuid><expression>nodata(/Envoy Proxy by HTTP/envoy.server.uptime,10m)=1</expression><name>Envoy Proxy: Failed to fetch metrics data</name><event_name>Envoy Proxy: Failed to fetch metrics data (or no data for 10m)</event_name><priority>WARNING</priority><description>Zabbix has not received data for items for the last 10 minutes.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger><trigger><uuid>01e29535e00143c9a64fe844f637f17e</uuid><expression>last(/Envoy Proxy by HTTP/envoy.server.uptime)&lt;10m</expression><name>Envoy Proxy: Service has been restarted</name><event_name>Envoy Proxy: Service has been restarted (uptime &lt; 10m)</event_name><priority>INFO</priority><description>Uptime is less than 10 minutes.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item></items><discovery_rules><discovery_rule><uuid>e5e43b5959744fdd94f103df8d33f635</uuid><name>Cluster metrics discovery</name><type>DEPENDENT</type><key>envoy.lld.cluster</key><delay>0</delay><item_prototypes><item_prototype><uuid>6040df76d67048aaa4217dc14a2db3ed</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Membership, degraded</name><type>DEPENDENT</type><key>envoy.cluster.membership_degraded[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><description>Current cluster degraded total.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_membership_degraded{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag></tags></item_prototype><item_prototype><uuid>0368ecc40bc54a70bae3c81509bad062</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Membership, healthy</name><type>DEPENDENT</type><key>envoy.cluster.membership_healthy[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><description>Current cluster healthy total (inclusive of both health checking and outlier detection).</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_membership_healthy{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag></tags></item_prototype><item_prototype><uuid>a4cd74b439e3483499e30ffefdb36976</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Membership, total</name><type>DEPENDENT</type><key>envoy.cluster.membership_total[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><description>Current cluster membership total.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_membership_total{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag></tags></item_prototype><item_prototype><uuid>d453ade473ae4beaab06afa117814a1b</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Membership, unhealthy</name><type>CALCULATED</type><key>envoy.cluster.membership_unhealthy[&quot;{#CLUSTER_NAME}&quot;]</key><history>7d</history><params>last(//envoy.cluster.membership_total[&quot;{#CLUSTER_NAME}&quot;]) - last(//envoy.cluster.membership_healthy[&quot;{#CLUSTER_NAME}&quot;])</params><description>Current cluster unhealthy.</description><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag></tags><trigger_prototypes><trigger_prototype><uuid>7542707fd247445cb9eaa51d01e76d5e</uuid><expression>last(/Envoy Proxy by HTTP/envoy.cluster.membership_unhealthy[&quot;{#CLUSTER_NAME}&quot;]) &gt; 0</expression><name>Envoy Proxy: There are unhealthy clusters</name><opdata>Current number: {ITEM.LASTVALUE1}</opdata><priority>AVERAGE</priority><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><uuid>b5c802ae97a0449cbbb7f43a2510fd56</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Connections, active</name><type>DEPENDENT</type><key>envoy.cluster.upstream_cx_active[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><description>Current cluster total active connections.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_cx_active{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>connections</value></tag></tags></item_prototype><item_prototype><uuid>c7106f0670764bc297920a5e62768c55</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Upstream bytes in, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_cx_rx_bytes_total.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>Bps</units><description>Total received connection bytes per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_cx_rx_bytes_total{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>network</value></tag></tags></item_prototype><item_prototype><uuid>d180e76ccb3a456b8100c4669173c0f7</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Connections, total</name><type>DEPENDENT</type><key>envoy.cluster.upstream_cx_total[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><description>Current cluster total connections.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_cx_total{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>connections</value></tag></tags></item_prototype><item_prototype><uuid>d024405b571946939fa20d495ef6c7d8</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Upstream bytes out, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_cx_tx_bytes_total.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>Bps</units><description>Total sent connection bytes per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_cx_tx_bytes_total{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>network</value></tag></tags></item_prototype><item_prototype><uuid>f6724ac1954e4c71a95a01a441d46e5d</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests 2xx, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_2x.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Aggregate HTTP response codes per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_xx{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;, envoy_response_code_class=&quot;2&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>248d268966ed4999916d77b340f82fa1</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests 3xx, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_3x.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Aggregate HTTP response codes per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_xx{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;, envoy_response_code_class=&quot;3&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>65e956c129e2436896f1a3d46a1f9090</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests 4xx, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_4x.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Aggregate HTTP response codes per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_xx{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;, envoy_response_code_class=&quot;4&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>a85872e72792460e97d8fd322e0919a1</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests 5xx, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_5x.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Aggregate HTTP response codes per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_xx{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;, envoy_response_code_class=&quot;5&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>a06b43daf8e2493eb61d27cea8baba79</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests active</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_active[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total active requests.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_active{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>bd1c6766c9e047f1a40f6b1f22f00623</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests completed, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_completed.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total upstream requests completed per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_completed{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>267c3d01aa614dbdb0f0dcbe3ab2e11b</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests pending</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_pending_active[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total active requests pending a connection pool connection.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_pending_active{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>2489b20b43044020a3ace164f6049af6</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests timeout, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_timeout.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Current cluster requests that timed out waiting for a response per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_timeout{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype><item_prototype><uuid>b807e34a608042419d69eae46aa4338c</uuid><name>Envoy Proxy: Cluster [&quot;{#CLUSTER_NAME}&quot;]: Requests total, rate</name><type>DEPENDENT</type><key>envoy.cluster.upstream_rq_total.rate[&quot;{#CLUSTER_NAME}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Current cluster request total per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_cluster_upstream_rq_total{envoy_cluster_name = &quot;{#CLUSTER_NAME}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>cluster</tag><value>{#CLUSTER_NAME}</value></tag><tag><tag>component</tag><value>cluster</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>a1ecd91cb0a44c39923d4b806aae4039</uuid><name>Envoy Proxy: [{#CLUSTER_NAME}] HTTP requests</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster.upstream_rq_2x.rate[&quot;{#CLUSTER_NAME}&quot;]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster.upstream_rq_3x.rate[&quot;{#CLUSTER_NAME}&quot;]</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster.upstream_rq_4x.rate[&quot;{#CLUSTER_NAME}&quot;]</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster.upstream_rq_5x.rate[&quot;{#CLUSTER_NAME}&quot;]</key></item></graph_item><graph_item><sortorder>4</sortorder><color>FC6EA3</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster.upstream_rq_total.rate[&quot;{#CLUSTER_NAME}&quot;]</key></item></graph_item></graph_items></graph_prototype><graph_prototype><uuid>46f4d9b835274a7dafdda64563f482a9</uuid><name>Envoy Proxy: [{#CLUSTER_NAME}] Upstream traffic</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster.upstream_cx_rx_bytes_total.rate[&quot;{#CLUSTER_NAME}&quot;]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster.upstream_cx_tx_bytes_total.rate[&quot;{#CLUSTER_NAME}&quot;]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>envoy.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>envoy_cluster_membership_total</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
        var envoy_cluster_name = item.labels.envoy_cluster_name;

        if (lookup[envoy_cluster_name]) {
            return;
        }
        lookup[envoy_cluster_name] = 1;
        result.push({
            '{#CLUSTER_NAME}': envoy_cluster_name
        });
});

return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>ea40e02e3b4e40ea989612949a1a8bef</uuid><name>HTTP metrics discovery</name><type>DEPENDENT</type><key>envoy.lld.http</key><delay>0</delay><item_prototypes><item_prototype><uuid>f4106316b7a44555bd2fcb98ed291a23</uuid><name>Envoy Proxy: HTTP [&quot;{#CONN_MANAGER}&quot;]: Connections, active</name><type>DEPENDENT</type><key>envoy.http.downstream_cx_active[&quot;{#CONN_MANAGER}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total active connections.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_http_downstream_cx_active{envoy_http_conn_manager_prefix = &quot;{#CONN_MANAGER}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>http</value></tag><tag><tag>connection-manager</tag><value>{#CONN_MANAGER}</value></tag></tags></item_prototype><item_prototype><uuid>d5f88107012a4a41a86cb9a76bf8ebc5</uuid><name>Envoy Proxy: HTTP [&quot;{#CONN_MANAGER}&quot;]: Bytes in, rate</name><type>DEPENDENT</type><key>envoy.http.downstream_cx_rx_bytes_total.rate[&quot;{#CONN_MANAGER}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total bytes received per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_http_downstream_cx_rx_bytes_total{envoy_http_conn_manager_prefix = &quot;{#CONN_MANAGER}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>http</value></tag><tag><tag>connection-manager</tag><value>{#CONN_MANAGER}</value></tag></tags></item_prototype><item_prototype><uuid>cff73e6c597d4103bdf6445b0910a434</uuid><name>Envoy Proxy: HTTP [&quot;{#CONN_MANAGER}&quot;]: Connections, rate</name><type>DEPENDENT</type><key>envoy.http.downstream_cx_total[&quot;{#CONN_MANAGER}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>Rps</units><description>Total connections per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_http_downstream_cx_total{envoy_http_conn_manager_prefix = &quot;{#CONN_MANAGER}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>http</value></tag><tag><tag>connection-manager</tag><value>{#CONN_MANAGER}</value></tag></tags></item_prototype><item_prototype><uuid>a0bc5e6a55af4fa29869f05c1c0943f6</uuid><name>Envoy Proxy: HTTP [&quot;{#CONN_MANAGER}&quot;]: Bytes out, rate</name><type>DEPENDENT</type><key>envoy.http.downstream_cx_tx_bytes_tota.rate[&quot;{#CONN_MANAGER}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total bytes sent per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_http_downstream_cx_tx_bytes_total{envoy_http_conn_manager_prefix = &quot;{#CONN_MANAGER}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>http</value></tag><tag><tag>connection-manager</tag><value>{#CONN_MANAGER}</value></tag></tags></item_prototype><item_prototype><uuid>19ce2a7cc34c4b49ad0117c62241eabf</uuid><name>Envoy Proxy: HTTP [&quot;{#CONN_MANAGER}&quot;]: Requests, active</name><type>DEPENDENT</type><key>envoy.http.downstream_rq_active[&quot;{#CONN_MANAGER}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total active requests.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_http_downstream_rq_active{envoy_http_conn_manager_prefix = &quot;{#CONN_MANAGER}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>http</value></tag><tag><tag>connection-manager</tag><value>{#CONN_MANAGER}</value></tag></tags></item_prototype><item_prototype><uuid>df31ba8ca0db4b2daade17a9a54273cf</uuid><name>Envoy Proxy: HTTP [&quot;{#CONN_MANAGER}&quot;]: Requests timeout, rate</name><type>DEPENDENT</type><key>envoy.http.downstream_rq_timeout[&quot;{#CONN_MANAGER}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total requests closed due to a timeout on the request path per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_http_downstream_rq_timeout{envoy_http_conn_manager_prefix = &quot;{#CONN_MANAGER}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>http</value></tag><tag><tag>connection-manager</tag><value>{#CONN_MANAGER}</value></tag></tags></item_prototype><item_prototype><uuid>87cc859a403348a2b7bcfa398b3150c8</uuid><name>Envoy Proxy: HTTP [&quot;{#CONN_MANAGER}&quot;]: Requests, rate</name><type>DEPENDENT</type><key>envoy.http.downstream_rq_total.rate[&quot;{#CONN_MANAGER}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>Rps</units><description>Total active connections per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_http_downstream_rq_total{envoy_http_conn_manager_prefix = &quot;{#CONN_MANAGER}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>http</value></tag><tag><tag>connection-manager</tag><value>{#CONN_MANAGER}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>71b114ee64d34d74a32b18e2f7d25d8c</uuid><name>Envoy Proxy: [{#CLUSTER_NAME}] Downstream traffic</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.http.downstream_cx_rx_bytes_total.rate[&quot;{#CONN_MANAGER}&quot;]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.http.downstream_cx_tx_bytes_tota.rate[&quot;{#CONN_MANAGER}&quot;]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>envoy.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>envoy_http_downstream_rq_total</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
        var envoy_http_conn_manager_prefix = item.labels.envoy_http_conn_manager_prefix;

        if (lookup[envoy_http_conn_manager_prefix]) {
            return;
        }
        lookup[envoy_http_conn_manager_prefix] = 1;
        result.push({
            '{#CONN_MANAGER}': envoy_http_conn_manager_prefix
        });
});

return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>953541f62c8c461795c2ebed7f4f52cf</uuid><name>Listeners metrics discovery</name><type>DEPENDENT</type><key>envoy.lld.listeners</key><delay>0</delay><item_prototypes><item_prototype><uuid>3ecae47c57984a6ab5ff854ce2e5415e</uuid><name>Envoy Proxy: Listener [&quot;{#LISTENER_ADDRESS}&quot;]: Connections, active</name><type>DEPENDENT</type><key>envoy.listener.downstream_cx_active[&quot;{#LISTENER_ADDRESS}&quot;]</key><delay>0</delay><history>7d</history><description>Total active connections.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_downstream_cx_active{envoy_listener_address = &quot;{#LISTENER_ADDRESS}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag><tag><tag>listener-address</tag><value>{#LISTENER_ADDRESS}</value></tag></tags></item_prototype><item_prototype><uuid>7cc50e3001ac4a8ca433529c52a56e83</uuid><name>Envoy Proxy: Listener [&quot;{#LISTENER_ADDRESS}&quot;]: Connections, rate</name><type>DEPENDENT</type><key>envoy.listener.downstream_cx_total.rate[&quot;{#LISTENER_ADDRESS}&quot;]</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Total connections per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_downstream_cx_total{envoy_listener_address = &quot;{#LISTENER_ADDRESS}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag><tag><tag>listener-address</tag><value>{#LISTENER_ADDRESS}</value></tag></tags></item_prototype><item_prototype><uuid>5c155a0d2fd14623ba51670e4083ecee</uuid><name>Envoy Proxy: Listener [&quot;{#LISTENER_ADDRESS}&quot;]: Sockets, undergoing</name><type>DEPENDENT</type><key>envoy.listener.downstream_pre_cx_active[&quot;{#LISTENER_ADDRESS}&quot;]</key><delay>0</delay><history>7d</history><description>Sockets currently undergoing listener filter processing.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>envoy_listener_downstream_pre_cx_active{envoy_listener_address = &quot;{#LISTENER_ADDRESS}&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters></step></preprocessing><master_item><key>envoy.get_metrics</key></master_item><tags><tag><tag>component</tag><value>listener</value></tag><tag><tag>listener-address</tag><value>{#LISTENER_ADDRESS}</value></tag></tags></item_prototype></item_prototypes><master_item><key>envoy.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>envoy_listener_downstream_cx_active</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
        var envoy_listener_address = item.labels.envoy_listener_address;

        if (lookup[envoy_listener_address]) {
            return;
        }
        lookup[envoy_listener_address] = 1;
        result.push({
            '{#LISTENER_ADDRESS}': envoy_listener_address
        });
});

return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing></discovery_rule></discovery_rules><tags><tag><tag>class</tag><value>software</value></tag><tag><tag>target</tag><value>envoy-proxy</value></tag></tags><macros><macro><macro>{$ENVOY.CERT.MIN}</macro><value>7</value><description>Minimum number of days before certificate expiration used for trigger expression.</description></macro><macro><macro>{$ENVOY.METRICS.PATH}</macro><value>/stats/prometheus</value><description>The path Zabbix will scrape metrics in prometheus format from.</description></macro><macro><macro>{$ENVOY.URL}</macro><value>http://localhost:9901</value><description>Instance URL.</description></macro></macros><valuemaps><valuemap><uuid>2152e7a114f3489eb6ea80b948c0db5c</uuid><name>Envoy listener manager</name><mappings><mapping><value>0</value><newvalue>Not started</newvalue></mapping><mapping><value>1</value><newvalue>Started</newvalue></mapping></mappings></valuemap><valuemap><uuid>c05c038099d74d11b6fef057518a1fc9</uuid><name>Envoy server live</name><mappings><mapping><value>0</value><newvalue>Not Live</newvalue></mapping><mapping><value>1</value><newvalue>Live</newvalue></mapping></mappings></valuemap><valuemap><uuid>f467d440b03e4dab8cc4b15f87185eb5</uuid><name>Envoy server state</name><mappings><mapping><value>0</value><newvalue>Live</newvalue></mapping><mapping><value>1</value><newvalue>Draining</newvalue></mapping><mapping><value>2</value><newvalue>Pre initializing</newvalue></mapping><mapping><value>3</value><newvalue>Initializing</newvalue></mapping></mappings></valuemap></valuemaps></template></templates><graphs><graph><uuid>9cf06c8169944ee2974499a4f2764903</uuid><name>Envoy Proxy: Clusters</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster_manager.active_clusters</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster_manager.warming_clusters</key></item></graph_item></graph_items></graph><graph><uuid>6453eec1ce9141b0a505d278f842ea1c</uuid><name>Envoy Proxy: Clusters operations</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster_manager.cluster_removed.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster_manager.cluster_updated.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster_manager.cluster_modified.rate</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Envoy Proxy by HTTP</host><key>envoy.cluster_manager.cluster_added.rate</key></item></graph_item></graph_items></graph><graph><uuid>0ac65256c79e4eb992afae8fdb7035c9</uuid><name>Envoy Proxy: Connections</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.server.parent_connections</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.server.memory_heap_size</key></item></graph_item></graph_items></graph><graph><uuid>d06a958289aa4c7a84851f5c9333e746</uuid><name>Envoy Proxy: Filesystem operations</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.filesystem.reopen_failed.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.filesystem.flushed_by_timer.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Envoy Proxy by HTTP</host><key>envoy.filesystem.write_completed.rate</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Envoy Proxy by HTTP</host><key>envoy.filesystem.write_failed.rate</key></item></graph_item></graph_items></graph><graph><uuid>d3d8733f333942849eadabb86049b5bf</uuid><name>Envoy Proxy: Listener manager</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.listener_manager.total_listeners_warming</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.listener_manager.total_listeners_draining</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Envoy Proxy by HTTP</host><key>envoy.listener_manager.total_listeners_active</key></item></graph_item></graph_items></graph><graph><uuid>90ef97d5dfd44349bc08c89acc0b7ec3</uuid><name>Envoy Proxy: Listeners operations</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.listener_manager.listener_create_failure.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.listener_manager.listener_create_success.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Envoy Proxy by HTTP</host><key>envoy.listener_manager.listener_added.rate</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Envoy Proxy by HTTP</host><key>envoy.listener_manager.listener_stopped.rate</key></item></graph_item></graph_items></graph><graph><uuid>ca3646c18e79468d884af478afab7b0e</uuid><name>Envoy Proxy: Memory usage</name><graph_items><graph_item><color>1A7C11</color><item><host>Envoy Proxy by HTTP</host><key>envoy.server.memory_physical_size</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Envoy Proxy by HTTP</host><key>envoy.server.memory_heap_size</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Envoy Proxy by HTTP</host><key>envoy.server.memory_allocated</key></item></graph_item></graph_items></graph></graphs></zabbix_export>
