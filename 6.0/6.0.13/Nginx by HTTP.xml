<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>6.0</version><date>2023-02-11T16:14:40Z</date><groups><group><uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid><name>Templates/Applications</name></group></groups><templates><template><uuid>13d5bb0a4ae84228bff408aab5be338e</uuid><template>Nginx by HTTP</template><name>Nginx by HTTP</name><description>Get metrics from stub status module using HTTP agent
https://nginx.ru/en/docs/http/ngx_http_stub_status_module.html.


You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384765-discussion-thread-for-official-zabbix-template-nginx

Template tooling version used: 0.41</description><groups><group><name>Templates/Applications</name></group></groups><items><item><uuid>18c6209295b347e2a96ef11b147139d8</uuid><name>Nginx: Service response time</name><type>SIMPLE</type><key>net.tcp.service.perf[http,&quot;{HOST.CONN}&quot;,&quot;{$NGINX.STUB_STATUS.PORT}&quot;]</key><history>7d</history><value_type>FLOAT</value_type><units>s</units><tags><tag><tag>component</tag><value>application</value></tag><tag><tag>component</tag><value>health</value></tag></tags><triggers><trigger><uuid>fc1f7927b8864996986c1da44df57279</uuid><expression>min(/Nginx by HTTP/net.tcp.service.perf[http,&quot;{HOST.CONN}&quot;,&quot;{$NGINX.STUB_STATUS.PORT}&quot;],5m)&gt;{$NGINX.RESPONSE_TIME.MAX.WARN}</expression><name>Nginx: Service response time is too high</name><event_name>Nginx: Service response time is too high (over {$NGINX.RESPONSE_TIME.MAX.WARN}s for 5m)</event_name><priority>WARNING</priority><manual_close>YES</manual_close><dependencies><dependency><name>Nginx: Service is down</name><expression>last(/Nginx by HTTP/net.tcp.service[http,&quot;{HOST.CONN}&quot;,&quot;{$NGINX.STUB_STATUS.PORT}&quot;])=0</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>performance</value></tag></tags></trigger></triggers></item><item><uuid>e4a09193bc8f42f2888ece83f89f84af</uuid><name>Nginx: Service status</name><type>SIMPLE</type><key>net.tcp.service[http,&quot;{HOST.CONN}&quot;,&quot;{$NGINX.STUB_STATUS.PORT}&quot;]</key><history>7d</history><valuemap><name>Service state</name></valuemap><preprocessing><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>10m</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>application</value></tag><tag><tag>component</tag><value>health</value></tag></tags><triggers><trigger><uuid>7b3de87ba0ea425280d42235bb626b8b</uuid><expression>last(/Nginx by HTTP/net.tcp.service[http,&quot;{HOST.CONN}&quot;,&quot;{$NGINX.STUB_STATUS.PORT}&quot;])=0</expression><name>Nginx: Service is down</name><priority>AVERAGE</priority><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item><item><uuid>e054b58ebbbe4b45961ba697b468ab9e</uuid><name>Nginx: Connections accepted per second</name><type>DEPENDENT</type><key>nginx.connections.accepted.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>The total number of accepted client connections.</description><preprocessing><step><type>REGEX</type><parameters><parameter>server accepts handled requests\s+([0-9]+) ([0-9]+) ([0-9]+)</parameter><parameter>\1</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>2e4b049ab60947d9a05165f67388e531</uuid><name>Nginx: Connections active</name><type>DEPENDENT</type><key>nginx.connections.active</key><delay>0</delay><history>7d</history><description>The current number of active client connections including Waiting connections.</description><preprocessing><step><type>REGEX</type><parameters><parameter>Active connections: ([0-9]+)</parameter><parameter>\1</parameter></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>eecc0e887a744627be7f3b01cec6d46e</uuid><name>Nginx: Connections dropped per second</name><type>DEPENDENT</type><key>nginx.connections.dropped.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>The total number of dropped client connections.</description><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var a = value.match(/server accepts handled requests\s+([0-9]+) ([0-9]+) ([0-9]+)/)
if (a) {
    return a[1]-a[2]
}</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags><triggers><trigger><uuid>79767fbc18594069a1fc0cbec832f8ff</uuid><expression>min(/Nginx by HTTP/nginx.connections.dropped.rate,5m) &gt; {$NGINX.DROP_RATE.MAX.WARN}</expression><name>Nginx: High connections drop rate</name><event_name>Nginx: High connections drop rate (more than {$NGINX.DROP_RATE.MAX.WARN} for 5m)</event_name><opdata>Current rate: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><description>The dropping rate connections is greater than {$NGINX.DROP_RATE.MAX.WARN} for the last 5 minutes.</description><dependencies><dependency><name>Nginx: Service is down</name><expression>last(/Nginx by HTTP/net.tcp.service[http,&quot;{HOST.CONN}&quot;,&quot;{$NGINX.STUB_STATUS.PORT}&quot;])=0</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>performance</value></tag></tags></trigger></triggers></item><item><uuid>a53cf4f2d2ad4a84a70ff57df6299adc</uuid><name>Nginx: Connections handled per second</name><type>DEPENDENT</type><key>nginx.connections.handled.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>The total number of handled connections. Generally, the parameter value is the same as accepts unless some resource limits have been reached (for example, the worker_connections limit).</description><preprocessing><step><type>REGEX</type><parameters><parameter>server accepts handled requests\s+([0-9]+) ([0-9]+) ([0-9]+)</parameter><parameter>\2</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>73493cbf8508419a8fed3abff8cc5851</uuid><name>Nginx: Connections reading</name><type>DEPENDENT</type><key>nginx.connections.reading</key><delay>0</delay><history>7d</history><description>The current number of connections where nginx is reading the request header.</description><preprocessing><step><type>REGEX</type><parameters><parameter>Reading: ([0-9]+) Writing: ([0-9]+) Waiting: ([0-9]+)</parameter><parameter>\1</parameter></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>cf393814511a48b498da8aab94d7ca00</uuid><name>Nginx: Connections waiting</name><type>DEPENDENT</type><key>nginx.connections.waiting</key><delay>0</delay><history>7d</history><description>The current number of idle client connections waiting for a request.</description><preprocessing><step><type>REGEX</type><parameters><parameter>Reading: ([0-9]+) Writing: ([0-9]+) Waiting: ([0-9]+)</parameter><parameter>\3</parameter></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>b0d63efb16984042945fe42e192f7d4e</uuid><name>Nginx: Connections writing</name><type>DEPENDENT</type><key>nginx.connections.writing</key><delay>0</delay><history>7d</history><description>The current number of connections where nginx is writing the response back to the client.</description><preprocessing><step><type>REGEX</type><parameters><parameter>Reading: ([0-9]+) Writing: ([0-9]+) Waiting: ([0-9]+)</parameter><parameter>\2</parameter></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>86f93d1941d147fe94d754eddd3e8ff2</uuid><name>Nginx: Get stub status page</name><type>HTTP_AGENT</type><key>nginx.get_stub_status</key><history>1h</history><trends>0</trends><value_type>TEXT</value_type><description>The following status information is provided:
Active connections - the current number of active client connections including Waiting connections.
Accepts - the total number of accepted client connections.
Handled - the total number of handled connections. Generally, the parameter value is the same as accepts unless some resource limits have been reached (for example, the worker_connections limit).
Requests - the total number of client requests.
Reading - the current number of connections where nginx is reading the request header.
Writing - the current number of connections where nginx is writing the response back to the client.
Waiting - the current number of idle client connections waiting for a request.
https://nginx.org/en/docs/http/ngx_http_stub_status_module.html</description><url>{$NGINX.STUB_STATUS.SCHEME}://{HOST.CONN}:{$NGINX.STUB_STATUS.PORT}/{$NGINX.STUB_STATUS.PATH}</url><retrieve_mode>BOTH</retrieve_mode><tags><tag><tag>component</tag><value>application</value></tag><tag><tag>component</tag><value>health</value></tag></tags><triggers><trigger><uuid>78e0a6322a1941469a0e108a9367c420</uuid><expression>find(/Nginx by HTTP/nginx.get_stub_status,,&quot;like&quot;,&quot;HTTP/1.1 200&quot;)=0 or
 nodata(/Nginx by HTTP/nginx.get_stub_status,30m)=1</expression><name>Nginx: Failed to fetch stub status page</name><event_name>Nginx: Failed to fetch stub status page (or no data for 30m)</event_name><priority>WARNING</priority><description>Zabbix has not received data for items for the last 30 minutes.</description><manual_close>YES</manual_close><dependencies><dependency><name>Nginx: Service is down</name><expression>last(/Nginx by HTTP/net.tcp.service[http,&quot;{HOST.CONN}&quot;,&quot;{$NGINX.STUB_STATUS.PORT}&quot;])=0</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item><item><uuid>071b3d77324740a59045be19da231d76</uuid><name>Nginx: Requests total</name><type>DEPENDENT</type><key>nginx.requests.total</key><delay>0</delay><history>7d</history><description>The total number of client requests.</description><preprocessing><step><type>REGEX</type><parameters><parameter>server accepts handled requests\s+([0-9]+) ([0-9]+) ([0-9]+)</parameter><parameter>\3</parameter></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag></tags></item><item><uuid>81b17056ec664f9f926a74ee390ab9c1</uuid><name>Nginx: Requests per second</name><type>DEPENDENT</type><key>nginx.requests.total.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>The total number of client requests.</description><preprocessing><step><type>REGEX</type><parameters><parameter>server accepts handled requests\s+([0-9]+) ([0-9]+) ([0-9]+)</parameter><parameter>\3</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag></tags></item><item><uuid>716b627d6d894ac2af3ae8c4aeaa8c0c</uuid><name>Nginx: Version</name><type>DEPENDENT</type><key>nginx.version</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><preprocessing><step><type>REGEX</type><parameters><parameter>Server: nginx\/(.+(?&lt;!\r))</parameter><parameter>\1</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1d</parameter></parameters></step></preprocessing><master_item><key>nginx.get_stub_status</key></master_item><tags><tag><tag>component</tag><value>application</value></tag></tags><triggers><trigger><uuid>0f2689d4967a446e98a107b933179817</uuid><expression>last(/Nginx by HTTP/nginx.version,#1)&lt;&gt;last(/Nginx by HTTP/nginx.version,#2) and length(last(/Nginx by HTTP/nginx.version))&gt;0</expression><name>Nginx: Version has changed</name><event_name>Nginx: Version has changed (new version: {ITEM.VALUE})</event_name><priority>INFO</priority><description>Nginx version has changed. Ack to close.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item></items><tags><tag><tag>class</tag><value>software</value></tag><tag><tag>target</tag><value>nginx</value></tag></tags><macros><macro><macro>{$NGINX.DROP_RATE.MAX.WARN}</macro><value>1</value><description>The critical rate of the dropped connections for trigger expression.</description></macro><macro><macro>{$NGINX.RESPONSE_TIME.MAX.WARN}</macro><value>10</value><description>The Nginx maximum response time in seconds for trigger expression.</description></macro><macro><macro>{$NGINX.STUB_STATUS.PATH}</macro><value>basic_status</value><description>The path of Nginx stub_status page.</description></macro><macro><macro>{$NGINX.STUB_STATUS.PORT}</macro><value>80</value><description>The port of Nginx stub_status host or container.</description></macro><macro><macro>{$NGINX.STUB_STATUS.SCHEME}</macro><value>http</value><description>The protocol http or https of Nginx stub_status host or container.</description></macro></macros><dashboards><dashboard><uuid>7d0bf76f09204bb7ba9ee995bf161d46</uuid><name>Nginx performance</name><pages><page><widgets><widget><type>GRAPH_CLASSIC</type><width>12</width><height>5</height><fields><field><type>INTEGER</type><name>source_type</name><value>0</value></field><field><type>GRAPH</type><name>graphid</name><value><host>Nginx by HTTP</host><name>Nginx: Connections by state</name></value></field></fields></widget><widget><type>GRAPH_CLASSIC</type><x>12</x><width>12</width><height>5</height><fields><field><type>INTEGER</type><name>source_type</name><value>0</value></field><field><type>GRAPH</type><name>graphid</name><value><host>Nginx by HTTP</host><name>Nginx: Requests per second</name></value></field></fields></widget><widget><type>GRAPH_CLASSIC</type><y>5</y><width>12</width><height>5</height><fields><field><type>INTEGER</type><name>source_type</name><value>0</value></field><field><type>GRAPH</type><name>graphid</name><value><host>Nginx by HTTP</host><name>Nginx: Connections per second</name></value></field></fields></widget></widgets></page></pages></dashboard></dashboards><valuemaps><valuemap><uuid>5c0883d194e8494498474106c22be2ca</uuid><name>Service state</name><mappings><mapping><value>0</value><newvalue>Down</newvalue></mapping><mapping><value>1</value><newvalue>Up</newvalue></mapping></mappings></valuemap></valuemaps></template></templates><graphs><graph><uuid>aedcbacee74f4b0c861546c56e0fa9ab</uuid><name>Nginx: Connections by state</name><graph_items><graph_item><drawtype>BOLD_LINE</drawtype><color>1A7C11</color><item><host>Nginx by HTTP</host><key>nginx.connections.active</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Nginx by HTTP</host><key>nginx.connections.waiting</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Nginx by HTTP</host><key>nginx.connections.writing</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Nginx by HTTP</host><key>nginx.connections.reading</key></item></graph_item></graph_items></graph><graph><uuid>6feb26e5eb3246c0adb8d151b1443859</uuid><name>Nginx: Connections per second</name><graph_items><graph_item><color>1A7C11</color><item><host>Nginx by HTTP</host><key>nginx.connections.accepted.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Nginx by HTTP</host><key>nginx.connections.handled.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Nginx by HTTP</host><key>nginx.connections.dropped.rate</key></item></graph_item></graph_items></graph><graph><uuid>43a87936b35d4d28a658f810c2162a72</uuid><name>Nginx: Requests per second</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx by HTTP</host><key>nginx.requests.total.rate</key></item></graph_item></graph_items></graph></graphs></zabbix_export>
