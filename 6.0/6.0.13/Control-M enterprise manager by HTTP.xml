<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>6.0</version><date>2023-02-11T16:15:11Z</date><groups><group><uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid><name>Templates/Applications</name></group></groups><templates><template><uuid>24b64f6d22b446dabecc86ee3f199004</uuid><template>Control-M enterprise manager by HTTP</template><name>Control-M enterprise manager by HTTP</name><description>This template is designed to get metrics from the Control-M Enterprise Manager using the Control-M Automation API with HTTP agent.

This template monitors active Service Level Agreement (SLA) services, discovers Control-M servers using Low Level Discovery and also creates host prototypes for them in conjunction with the `Control-M server by HTTP` template.

To use this template, macros `{$API.TOKEN}` and `{$API.URI.ENDPOINT}` need to be set.

Generated by official Zabbix template tool pre-beta 2.0-21112022</description><groups><group><name>Templates/Applications</name></group></groups><items><item><uuid>7d9ed576aeb045798b78414c89f3e597</uuid><name>Control-M: Get Control-M servers</name><type>HTTP_AGENT</type><key>controlm.servers</key><delay>10m</delay><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Gets a list of servers.</description><url>{$API.URI.ENDPOINT}/config/servers</url><headers><header><name>x-api-key</name><value>{$API.TOKEN}</value></header></headers><tags><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>2bd2c27b8dc74656a00f6d2006399388</uuid><name>Control-M: Get SLA services</name><type>HTTP_AGENT</type><key>controlm.services</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Gets all the SLA active services.</description><url>{$API.URI.ENDPOINT}/run/services/sla</url><headers><header><name>x-api-key</name><value>{$API.TOKEN}</value></header></headers><tags><tag><tag>component</tag><value>raw</value></tag></tags></item></items><discovery_rules><discovery_rule><uuid>388824178c264d51be116a693c2640de</uuid><name>Server discovery</name><type>DEPENDENT</type><key>controlm.server.discovery</key><delay>0</delay><description>Discovers the Control-M servers.</description><host_prototypes><host_prototype><uuid>1ade45fcbb9e407ca32542564b12f2b1</uuid><host>{#SERVER.NAME}</host><name>Control-M server [{#SERVER.NAME}]</name><group_links><group_link><group><name>Templates/Applications</name></group></group_link></group_links><group_prototypes><group_prototype><name>Control-M/{#SERVER.NAME}</name></group_prototype></group_prototypes><templates><template><name>Control-M server by HTTP</name></template></templates><macros><macro><macro>{$SERVER.NAME}</macro><value>{#SERVER.NAME}</value></macro></macros></host_prototype></host_prototypes><master_item><key>controlm.servers</key></master_item><lld_macro_paths><lld_macro_path><lld_macro>{#SERVER.NAME}</lld_macro><path>$.name</path></lld_macro_path></lld_macro_paths><preprocessing><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>2h</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>567e5e0553c84ce2a9200d14dfc76593</uuid><name>SLA services discovery</name><type>DEPENDENT</type><key>controlm.services.discovery</key><delay>0</delay><lifetime>1d</lifetime><description>Discovers the SLA services in the Control-M environment.</description><item_prototypes><item_prototype><uuid>9daecffe0dfd402fb7300d484c2e9b80</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'completed'</name><type>DEPENDENT</type><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',completed]</key><delay>0</delay><description>Gets the number of jobs in the state - `completed`.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.statusByJobs.completed</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>jobs-completed</value></tag><tag><tag>service-metric</tag><value>jobs-stats</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags></item_prototype><item_prototype><uuid>27821e573ead422b830b4f9dba5c840f</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'error'</name><type>DEPENDENT</type><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',error]</key><delay>0</delay><description>Gets the number of jobs in the state - `error`.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.statusByJobs.error</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>jobs-error</value></tag><tag><tag>service-metric</tag><value>jobs-stats</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags><trigger_prototypes><trigger_prototype><uuid>c66f281b78e64c1c9c96ade1450eadbb</uuid><expression>last(/Control-M enterprise manager by HTTP/service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',error],#1)&gt;0</expression><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs in 'error' state</name><opdata>Trigger value '{ITEM.VALUE}', Current value '{ITEM.LASTVALUE}'</opdata><priority>AVERAGE</priority><description>There are services present which are in the state - `error`.</description><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><uuid>fe58d60475bd49f2a4e3f0bfc5ae020f</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'executed'</name><type>DEPENDENT</type><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',executed]</key><delay>0</delay><description>Gets the number of jobs in the state - `executed`.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.statusByJobs.executed</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>jobs-executed</value></tag><tag><tag>service-metric</tag><value>jobs-stats</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags></item_prototype><item_prototype><uuid>2843e6ba50584b27a66165f0accc5ed5</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitCondition'</name><type>DEPENDENT</type><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitCondition]</key><delay>0</delay><description>Gets the number of jobs in the state - `waitCondition`.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.statusByJobs.waitCondition</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>jobs-stats</value></tag><tag><tag>service-metric</tag><value>jobs-wait_condition</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags></item_prototype><item_prototype><uuid>409961fd6fed4f208340dfdb978a2430</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitHost'</name><type>DEPENDENT</type><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitHost]</key><delay>0</delay><description>Gets the number of jobs in the state - `waitHost`.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.statusByJobs.waitHost</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>jobs-stats</value></tag><tag><tag>service-metric</tag><value>jobs-wait_host</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags></item_prototype><item_prototype><uuid>6ae1bd92bd39446fbbea847088cd37e7</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitResource'</name><type>DEPENDENT</type><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitResource]</key><delay>0</delay><description>Gets the number of jobs in the state - `waitResource`.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.statusByJobs.waitResource</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>jobs-stats</value></tag><tag><tag>service-metric</tag><value>jobs-wait-resource</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags></item_prototype><item_prototype><uuid>0299415dfbca4ba6881a890bb9e9658c</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitWorkload'</name><type>DEPENDENT</type><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitWorkload]</key><delay>0</delay><description>Gets the number of jobs in the state - `waitWorkload`.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.statusByJobs.waitWorkload</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>jobs-stats</value></tag><tag><tag>service-metric</tag><value>jobs-wait_workload</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags></item_prototype><item_prototype><uuid>72516fca80024f9884efb7dd652f957e</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: stats</name><type>DEPENDENT</type><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key><delay>0</delay><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Gets the service statistics.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.activeServices.[?(@.serviceName == '{#SERVICE.NAME}')]</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>JSONPATH</type><parameters><parameter>$.[?(@.serviceJob == '{#SERVICE.JOB}')].first()</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>controlm.services</key></master_item><tags><tag><tag>component</tag><value>raw</value></tag></tags></item_prototype><item_prototype><uuid>a3f556bfb8d04a70b0c7407cdc458703</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: status</name><type>DEPENDENT</type><key>service.status['{#SERVICE.NAME}','{#SERVICE.JOB}']</key><delay>0</delay><description>Gets the service status.</description><valuemap><name>Control-M service status</name></valuemap><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.status</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>// value list might be incomplete
const idx = [       // 10 - (default)
    'Not Ok',       // 0
    'Ok',           // 1
    'Completed Ok', // 2
    'Ended Late'    // 3
].indexOf(value);
return idx !== -1 ? idx : 10;</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}']</key></master_item><tags><tag><tag>component</tag><value>service</value></tag><tag><tag>service-metric</tag><value>status</value></tag><tag><tag>service-name</tag><value>{#SERVICE.NAME}</value></tag></tags><trigger_prototypes><trigger_prototype><uuid>e032410a5384441989538ff6781ef848</uuid><expression>last(/Control-M enterprise manager by HTTP/service.status['{#SERVICE.NAME}','{#SERVICE.JOB}'],#1)=0 or
last(/Control-M enterprise manager by HTTP/service.status['{#SERVICE.NAME}','{#SERVICE.JOB}'],#1)=10</expression><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: status [{ITEM.VALUE}]</name><priority>AVERAGE</priority><description>The service has encountered an issue.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype><trigger_prototype><uuid>f64b017b0cf9456eb0afdf908cf2258e</uuid><expression>last(/Control-M enterprise manager by HTTP/service.status['{#SERVICE.NAME}','{#SERVICE.JOB}'],#1)=3</expression><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: status [{ITEM.VALUE}]</name><priority>WARNING</priority><description>The service has finished its job late.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>53190fc52e094018926ca5351198aace</uuid><name>Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs statuses</name><graph_items><graph_item><drawtype>DASHED_LINE</drawtype><color>29235c</color><item><host>Control-M enterprise manager by HTTP</host><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',executed]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>DASHED_LINE</drawtype><color>7e286e</color><item><host>Control-M enterprise manager by HTTP</host><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitCondition]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>DASHED_LINE</drawtype><color>c73464</color><item><host>Control-M enterprise manager by HTTP</host><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitResource]</key></item></graph_item><graph_item><sortorder>3</sortorder><drawtype>DASHED_LINE</drawtype><color>f66343</color><item><host>Control-M enterprise manager by HTTP</host><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitHost]</key></item></graph_item><graph_item><sortorder>4</sortorder><drawtype>DASHED_LINE</drawtype><color>ffa600</color><item><host>Control-M enterprise manager by HTTP</host><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitWorkload]</key></item></graph_item><graph_item><sortorder>5</sortorder><color>00FF00</color><yaxisside>RIGHT</yaxisside><item><host>Control-M enterprise manager by HTTP</host><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',completed]</key></item></graph_item><graph_item><sortorder>6</sortorder><color>FF0000</color><item><host>Control-M enterprise manager by HTTP</host><key>service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',error]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>controlm.services</key></master_item><lld_macro_paths><lld_macro_path><lld_macro>{#SERVICE.JOB}</lld_macro><path>$.serviceJob</path></lld_macro_path><lld_macro_path><lld_macro>{#SERVICE.NAME}</lld_macro><path>$.serviceName</path></lld_macro_path></lld_macro_paths><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.activeServices</parameter></parameters><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>[]</error_handler_params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing></discovery_rule></discovery_rules><tags><tag><tag>class</tag><value>software</value></tag><tag><tag>target</tag><value>controlm</value></tag></tags><macros><macro><macro>{$API.TOKEN}</macro><type>SECRET_TEXT</type><description>A token to use for API connections.</description></macro><macro><macro>{$API.URI.ENDPOINT}</macro><value>&lt;set the api uri endpoint here&gt;</value><description>The API endpoint is a URI - for example, `https://monitored.controlm.instance:8443/automation-api`.</description></macro></macros><valuemaps><valuemap><uuid>54213ae65be64878988c9145d8ae86e4</uuid><name>Control-M service status</name><mappings><mapping><value>0</value><newvalue>Not Ok</newvalue></mapping><mapping><value>1</value><newvalue>Ok</newvalue></mapping><mapping><value>2</value><newvalue>Completed Ok</newvalue></mapping><mapping><value>3</value><newvalue>Ended Late</newvalue></mapping><mapping><value>10</value><newvalue>Unknown</newvalue></mapping></mappings></valuemap></valuemaps></template></templates></zabbix_export>
