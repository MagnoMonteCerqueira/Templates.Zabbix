<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>6.0</version><date>2023-02-11T16:15:07Z</date><groups><group><uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid><name>Templates/Applications</name></group></groups><templates><template><uuid>2420a8a4fda74fbc81743aed69fafa3b</uuid><template>Kubernetes Controller manager by HTTP</template><name>Kubernetes Controller manager by HTTP</name><description>Get Kubernetes Controller manager metrics by HTTP agent from Prometheus metrics endpoint.

Don't forget change macros {$KUBE.API.SERVER.URL}.
Some metrics may not be collected depending on your Kubernetes Controller manager instance version and configuration.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Template tooling version used: 0.41</description><groups><group><name>Templates/Applications</name></group></groups><items><item><uuid>774693b22f844424a93f6a56001c8cba</uuid><name>Kubernetes Controller Manager: REST Client requests: 2xx, rate</name><type>DEPENDENT</type><key>kubernetes.controller.client_http_requests_200.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 2xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;2..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>rest</value></tag><tag><tag>http-code</tag><value>2xx</value></tag></tags></item><item><uuid>ace0d156101b481d9f53c3f48e84bd38</uuid><name>Kubernetes Controller Manager: REST Client requests: 3xx, rate</name><type>DEPENDENT</type><key>kubernetes.controller.client_http_requests_300.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 3xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;3..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>rest</value></tag><tag><tag>http-code</tag><value>3xx</value></tag></tags></item><item><uuid>c6b67e4330184ca98281773c69925d98</uuid><name>Kubernetes Controller Manager: REST Client requests: 4xx, rate</name><type>DEPENDENT</type><key>kubernetes.controller.client_http_requests_400.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 4xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;4..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>rest</value></tag><tag><tag>http-code</tag><value>4xx</value></tag></tags></item><item><uuid>ac6397e9f62749199f857e6c859daa59</uuid><name>Kubernetes Controller Manager: REST Client requests: 5xx, rate</name><type>DEPENDENT</type><key>kubernetes.controller.client_http_requests_500.rate</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of HTTP requests with 5xx status code per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>rest_client_requests_total{code =~ &quot;5..&quot;}</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>rest</value></tag><tag><tag>http-code</tag><value>5xx</value></tag></tags><triggers><trigger><uuid>13c32daebddd454bb5908a9a27c3a76f</uuid><expression>min(/Kubernetes Controller manager by HTTP/kubernetes.controller.client_http_requests_500.rate,5m)&gt;{$KUBE.CONTROLLER.HTTP.CLIENT.ERROR}</expression><name>Kubernetes Controller Manager: Too many HTTP client errors</name><event_name>Kubernetes Controller Manager: Too many HTTP client errors (over {$KUBE.CONTROLLER.HTTP.CLIENT.ERROR} for 5m)</event_name><priority>WARNING</priority><description>&quot;Kubernetes Controller manager is experiencing high error rate (with 5xx HTTP code).</description><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item><item><uuid>6bde8365469f47359fcc5716207b8870</uuid><name>Kubernetes Controller Manager: CPU</name><type>DEPENDENT</type><key>kubernetes.controller.cpu.util</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>%</units><description>Total user and system CPU usage ratio.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_cpu_seconds_total</parameter><parameter>value</parameter><parameter/></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step><step><type>MULTIPLIER</type><parameters><parameter>100</parameter></parameters></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>cpu</value></tag></tags></item><item><uuid>c684929ea8444a6aa24f1fb80812a6eb</uuid><name>Kubernetes Controller: Get Controller metrics</name><type>HTTP_AGENT</type><key>kubernetes.controller.get_metrics</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Get raw metrics from Controller instance /metrics endpoint.</description><preprocessing><step><type>CHECK_NOT_SUPPORTED</type><parameters><parameter/></parameters></step></preprocessing><timeout>15s</timeout><url>{$KUBE.CONTROLLER.SERVER.URL}</url><headers><header><name>Authorization</name><value>Bearer {$KUBE.API.TOKEN}</value></header></headers><tags><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>8e4f98354c89410ebad42af485e3f710</uuid><name>Kubernetes Controller Manager: Goroutines</name><type>DEPENDENT</type><key>kubernetes.controller.go_goroutines</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of goroutines that currently exist.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>go_goroutines</parameter><parameter>function</parameter><parameter>sum</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>goroutines</value></tag></tags></item><item><uuid>f30ba3d8679b4ffd86a20427892da228</uuid><name>Kubernetes Controller Manager: Go threads</name><type>DEPENDENT</type><key>kubernetes.controller.go_threads</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of OS threads created.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>go_threads</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>go-threads</value></tag></tags></item><item><uuid>b9ef0724331f4f9da830c470b8e2fea1</uuid><name>Kubernetes Controller Manager: Leader election status</name><type>DEPENDENT</type><key>kubernetes.controller.leader_election_master_status</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Gauge of if the reporting system is master of the relevant lease, 0 indicates backup, 1 indicates master.</description><valuemap><name>Leader status</name></valuemap><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>leader_election_master_status</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>leader</value></tag></tags></item><item><uuid>5bb0657b329c44e6a7a6dd169551205b</uuid><name>Kubernetes Controller Manager: Fds max</name><type>DEPENDENT</type><key>kubernetes.controller.max_fds</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Maximum allowed open file descriptors.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_max_fds</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>fds</value></tag></tags></item><item><uuid>43698df9a76c410792f0fdb9d41ee42c</uuid><name>Kubernetes Controller Manager: Fds open</name><type>DEPENDENT</type><key>kubernetes.controller.open_fds</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><description>Number of open file descriptors.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_open_fds</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>fds</value></tag></tags></item><item><uuid>7497f4f8d1d8422dad301d9d25b42150</uuid><name>Kubernetes Controller Manager: Resident memory, bytes</name><type>DEPENDENT</type><key>kubernetes.controller.process_resident_memory_bytes</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>B</units><description>Resident memory size in bytes.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_resident_memory_bytes</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>memory</value></tag></tags></item><item><uuid>884a7a4de05548ffbdf14629bbe5d181</uuid><name>Kubernetes Controller Manager: Virtual memory, bytes</name><type>DEPENDENT</type><key>kubernetes.controller.process_virtual_memory_bytes</key><delay>0</delay><history>7d</history><value_type>FLOAT</value_type><units>B</units><description>Virtual memory size in bytes.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>process_virtual_memory_bytes</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>memory</value></tag></tags></item></items><discovery_rules><discovery_rule><uuid>3117060c51564c2e897e3194821b137f</uuid><name>Workqueue metrics discovery</name><type>DEPENDENT</type><key>kubernetes.controller.workqueue.discovery</key><delay>0</delay><item_prototypes><item_prototype><uuid>70277a128a254462ad0bf7a023738ba0</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue duration seconds bucket, {#LE}</name><type>DEPENDENT</type><key>kubernetes.controller.duration_seconds_bucket[{#LE},&quot;{#NAME}&quot;]</key><delay>0</delay><history>1h</history><trends>0</trends><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><description>How long in seconds processing an item from workqueue takes.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_work_duration_seconds_bucket{name = &quot;{#NAME}&quot;,le = &quot;{#LE}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>8357905c82ea42b98d686eee2d9c35f6</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Queue duration seconds bucket, {#LE}</name><type>DEPENDENT</type><key>kubernetes.controller.queue_duration_seconds_bucket[{#LE},&quot;{#NAME}&quot;]</key><delay>0</delay><history>1h</history><trends>0</trends><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><description>How long in seconds an item stays in workqueue before being requested.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_queue_duration_seconds_bucket{name = &quot;{#NAME}&quot;,le = &quot;{#LE}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>940dc936417849c7aed7ae824883fdaf</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue adds total, rate</name><type>DEPENDENT</type><key>kubernetes.controller.workqueue_adds_total[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><description>Total number of adds handled by workqueue per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_adds_total{name = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>7edfab667cdf41908bd551c0a25e4adc</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue depth</name><type>DEPENDENT</type><key>kubernetes.controller.workqueue_depth[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><description>Current depth of workqueue.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_depth{name = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>9a510f3b3d3547c1817b72e38340ccd2</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue longest running processor, sec</name><type>DEPENDENT</type><key>kubernetes.controller.workqueue_longest_running_processor_seconds[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><description>How many seconds has the longest running processor for workqueue been running.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_longest_running_processor_seconds{name = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>0657d0741d5649a2b0ad87c2f39dc243</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue queue duration, 50p</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_queue_duration_seconds_p50[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.queue_duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,50)</params><description>50 percentile of how long in seconds an item stays in workqueue before being requested. If there are no requests for 5 minute, item value will be discarded.</description><preprocessing><step><type>CHECK_NOT_SUPPORTED</type><parameters><parameter/></parameters></step></preprocessing><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>9f976d181b7f4776a271e683d9efd396</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue queue duration, p90</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_queue_duration_seconds_p90[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.queue_duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,90)</params><description>90 percentile of how long in seconds an item stays in workqueue before being requested, by queue.</description><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>ce4b9daa161742ffb6fec0790c1dc689</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue queue duration, p95</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_queue_duration_seconds_p95[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.queue_duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,95)</params><description>95 percentile of how long in seconds an item stays in workqueue before being requested, by queue.</description><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>61d5f616cc474ae3adfcbd1a15fdd607</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue queue duration, p99</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_queue_duration_seconds_p99[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.queue_duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,99)</params><description>99 percentile of how long in seconds an item stays in workqueue before being requested, by queue.</description><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>a4e25b0e8cd340d48e098b89ffcdd49a</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue retries, rate</name><type>DEPENDENT</type><key>kubernetes.controller.workqueue_retries_total[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><description>Total number of retries handled by workqueue per second.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_retries_total{name = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>e230e1573f4042b088a8a4b2e3998d43</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue unfinished work, sec</name><type>DEPENDENT</type><key>kubernetes.controller.workqueue_unfinished_work_seconds[&quot;{#NAME}&quot;]</key><delay>0</delay><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><description>How many seconds of work has done that is in progress and hasn't been observed by work_duration. Large values indicate stuck threads. One can deduce the number of stuck threads by observing the rate at which this increases.</description><preprocessing><step><type>PROMETHEUS_PATTERN</type><parameters><parameter>workqueue_unfinished_work_seconds{name = &quot;{#NAME}&quot;}</parameter><parameter>value</parameter><parameter/></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>kubernetes.controller.get_metrics</key></master_item><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>68efc8bc4fec458384e21b7b19db696c</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue work duration, 50p</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_work_duration_seconds_p50[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,50)</params><description>50 percentiles of how long in seconds processing an item from workqueue takes, by queue.</description><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>ff4f4b222dfd47f69b96513fed4393f5</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue work duration, p90</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_work_duration_seconds_p90[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,90)</params><description>90 percentile of how long in seconds processing an item from workqueue takes, by queue.</description><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>34a688601a404d63aea3a774a9f5970a</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue work duration, p95</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_work_duration_seconds_p95[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,95)</params><description>95 percentile of how long in seconds processing an item from workqueue takes, by queue.</description><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>e5b4ea49906e4a12b01757854a5766a4</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;]: Workqueue work duration, p99</name><type>CALCULATED</type><key>kubernetes.controller.workqueue_work_duration_seconds_p99[&quot;{#NAME}&quot;]</key><history>7d</history><discover>NO_DISCOVER</discover><value_type>FLOAT</value_type><units>s</units><params>bucket_percentile(//kubernetes.controller.duration_seconds_bucket[*,&quot;{#NAME}&quot;],5m,99)</params><description>99 percentile of how long in seconds processing an item from workqueue takes, by queue.</description><tags><tag><tag>component</tag><value>workqueue</value></tag><tag><tag>workqueue</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>40113b2f3fe04e9dbfd4d6dc204be7ce</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;] Workqueue add rate</name><graph_items><graph_item><color>1A7C11</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_adds_total[&quot;{#NAME}&quot;]</key></item></graph_item></graph_items></graph_prototype><graph_prototype><uuid>99bd6b4904964738a2ba7f165cc78d9c</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;] Workqueue depth</name><graph_items><graph_item><color>1A7C11</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_depth[&quot;{#NAME}&quot;]</key></item></graph_item></graph_items></graph_prototype><graph_prototype><uuid>4f823f87056b42d29a284f8e2614b76f</uuid><name>Kubernetes Controller Manager: [&quot;{#NAME}&quot;] Workqueue latency</name><graph_items><graph_item><color>1A7C11</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_queue_duration_seconds_p95[&quot;{#NAME}&quot;]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_queue_duration_seconds_p99[&quot;{#NAME}&quot;]</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_queue_duration_seconds_p90[&quot;{#NAME}&quot;]</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_queue_duration_seconds_p50[&quot;{#NAME}&quot;]</key></item></graph_item><graph_item><sortorder>4</sortorder><color>FC6EA3</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_work_duration_seconds_p95[&quot;{#NAME}&quot;]</key></item></graph_item><graph_item><sortorder>5</sortorder><color>6C59DC</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_work_duration_seconds_p99[&quot;{#NAME}&quot;]</key></item></graph_item><graph_item><sortorder>6</sortorder><color>AC8C14</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_work_duration_seconds_p90[&quot;{#NAME}&quot;]</key></item></graph_item><graph_item><sortorder>7</sortorder><color>611F27</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.workqueue_work_duration_seconds_p50[&quot;{#NAME}&quot;]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>kubernetes.controller.get_metrics</key></master_item><preprocessing><step><type>PROMETHEUS_TO_JSON</type><parameters><parameter>{__name__=~ &quot;workqueue_*&quot;, name =~ &quot;.*&quot;}</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var lookup = {},
    result = [];

JSON.parse(value).forEach(function (item) {
    if (item.name === 'workqueue_adds_total') {
        var label_name = item.labels.name;

        if (lookup[label_name]) {
            return;
        }
        lookup[label_name] = 1;
        result.push({
            '{#TYPE}': 'totals',
            '{#NAME}': label_name
        });
    }
    else if  (item.name === 'workqueue_work_duration_seconds_bucket') {
        result.push({
            '{#TYPE}': 'buckets',
            '{#NAME}': item.labels.name,
            '{#LE}': item.labels.le
        });
    }
});

return JSON.stringify(result);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><overrides><override><name>bucket item</name><step>1</step><filter><conditions><condition><macro>{#TYPE}</macro><value>buckets</value><formulaid>A</formulaid></condition></conditions></filter><operations><operation><operationobject>ITEM_PROTOTYPE</operationobject><operator>LIKE</operator><value>bucket</value><status>ENABLED</status><discover>DISCOVER</discover></operation></operations></override><override><name>total item</name><step>2</step><filter><conditions><condition><macro>{#TYPE}</macro><value>totals</value><formulaid>A</formulaid></condition></conditions></filter><operations><operation><operationobject>ITEM_PROTOTYPE</operationobject><operator>NOT_LIKE</operator><value>bucket</value><status>ENABLED</status><discover>DISCOVER</discover></operation></operations></override></overrides></discovery_rule></discovery_rules><tags><tag><tag>class</tag><value>software</value></tag><tag><tag>target</tag><value>kubernetes controller manager</value></tag></tags><macros><macro><macro>{$KUBE.API.TOKEN}</macro><description>API Authorization Token</description></macro><macro><macro>{$KUBE.CONTROLLER.HTTP.CLIENT.ERROR}</macro><value>2</value><description>Maximum number of HTTP client requests failures used for trigger</description></macro><macro><macro>{$KUBE.CONTROLLER.SERVER.URL}</macro><value>http://localhost:10252/metrics</value><description>Instance URL</description></macro></macros><valuemaps><valuemap><uuid>fa1732213d27418a88a61c964d93e9d7</uuid><name>Leader status</name><mappings><mapping><value>0</value><newvalue>backup</newvalue></mapping><mapping><value>1</value><newvalue>master</newvalue></mapping></mappings></valuemap></valuemaps></template></templates><graphs><graph><uuid>23af35d1d9af40e2ace1915ab8df7eec</uuid><name>Kubernetes Controller Manager: Memory usage</name><graph_items><graph_item><color>1A7C11</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.process_virtual_memory_bytes</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.process_resident_memory_bytes</key></item></graph_item></graph_items></graph><graph><uuid>908af34b10044af9b028e5e024eb89b3</uuid><name>Kubernetes Controller Manager: REST Client query rate</name><graph_items><graph_item><color>1A7C11</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.client_http_requests_500.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.client_http_requests_400.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F63100</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.client_http_requests_300.rate</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Kubernetes Controller manager by HTTP</host><key>kubernetes.controller.client_http_requests_200.rate</key></item></graph_item></graph_items></graph></graphs></zabbix_export>
