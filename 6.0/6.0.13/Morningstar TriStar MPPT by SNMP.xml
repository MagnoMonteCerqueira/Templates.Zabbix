<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>6.0</version><date>2023-02-11T16:14:50Z</date><groups><group><uuid>36bff6c29af64692839d077febfc7079</uuid><name>Templates/Network devices</name></group></groups><templates><template><uuid>07b32152c3654e8ead4c1eeae24efa8f</uuid><template>Morningstar TriStar MPPT by SNMP</template><name>Morningstar TriStar MPPT by SNMP</name><description>MIBs used:
TRISTAR-MPPT

Template tooling version used: 0.41</description><groups><group><name>Templates/Network devices</name></group></groups><items><item><uuid>2c3dcfd83bf946fb9da84f648c1efbac</uuid><name>Array: Array Current</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.31.0</snmp_oid><key>array.current[arrayCurrent.0]</key><history>7d</history><value_type>FLOAT</value_type><units>A</units><description>MIB: TRISTAR-MPPT
Description:Array Current
Scaling Factor:0.00244140625
Units:A
Range:[-10, 80]
Modbus address:0x001d</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.00244140625</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>array</value></tag></tags></item><item><uuid>53c1cccd0262422eb18bb6745adb2369</uuid><name>Array: Sweep Pmax</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.33.0</snmp_oid><key>array.sweep_pmax[arrayPmaxLastSweep.0]</key><history>7d</history><value_type>FLOAT</value_type><units>W</units><description>MIB: TRISTAR-MPPT
Description:Pmax (last sweep)
Scaling Factor:0.10986328125
Units:W
Range:[-10, 5000]
Modbus address:0x003c</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.1098632813</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>array</value></tag></tags></item><item><uuid>2f0bbf8b6d53457283069aaf8e0386ae</uuid><name>Array: Sweep Vmp</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.34.0</snmp_oid><key>array.sweep_vmp[arrayVmpLastSweep.0]</key><history>7d</history><value_type>FLOAT</value_type><units>V</units><description>MIB: TRISTAR-MPPT
Description:Vmp (last sweep)
Scaling Factor:0.0054931640625
Units:V
Range:[-10, 180.0]
Modbus address:0x003d</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.005493164063</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>array</value></tag></tags></item><item><uuid>ced0f7c4abb6409399a9e05797841497</uuid><name>Array: Sweep Voc</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.35.0</snmp_oid><key>array.sweep_voc[arrayVocLastSweep.0]</key><history>7d</history><value_type>FLOAT</value_type><units>V</units><description>MIB: TRISTAR-MPPT
Description:Voc (last sweep)
Scaling Factor:0.0054931640625
Units:V
Range:[-10, 180.0]
Modbus address:0x003e</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.005493164063</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>array</value></tag></tags></item><item><uuid>419b9faf88284121a8806c60c8a4550d</uuid><name>Array: Voltage</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.30.0</snmp_oid><key>array.voltage[arrayVoltage.0]</key><history>7d</history><value_type>FLOAT</value_type><units>V</units><description>MIB: TRISTAR-MPPT
Description:Array Voltage
Scaling Factor:0.0054931640625
Units:V
Range:[-10, 180]
Modbus address:0x001b</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.005493164063</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>array</value></tag></tags></item><item><uuid>f40795d2c28b4f53ac50399ca6e6f8d6</uuid><name>Battery: Battery Voltage discovery</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.36.0</snmp_oid><key>battery.voltage.discovery[batteryVoltage.0]</key><delay>15m</delay><history>0</history><value_type>FLOAT</value_type><units>V</units><description>MIB: TRISTAR-MPPT</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.005493164063</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>battery</value></tag><tag><tag>component</tag><value>discovery</value></tag><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>e1646c9847064d53913d9c57d1b59de7</uuid><name>Battery: Charge Current</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.42.0</snmp_oid><key>charge.current[batteryCurrent.0]</key><history>7d</history><value_type>FLOAT</value_type><units>A</units><description>MIB: TRISTAR-MPPT
Description:Battery Current
Scaling Factor:0.00244140625
Units:A
Range:[-10, 80]
Modbus address:0x001c</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.00244140625</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>battery</value></tag></tags></item><item><uuid>e70284aa07924a61add98dc516f0429e</uuid><name>Battery: Output Power</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.44.0</snmp_oid><key>charge.output_power[ outputPower.0]</key><history>7d</history><value_type>FLOAT</value_type><units>W</units><description>MIB: TRISTAR-MPPT
Description:Output Power
Scaling Factor:0.10986328125
Units:W
Range:[-10, 5000]
Modbus address:0x003a</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.1098632813</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>battery</value></tag></tags></item><item><uuid>7ad0e0153d6342a5bdd1576b2ad815e3</uuid><name>Battery: Charge State</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.46.0</snmp_oid><key>charge.state[chargeState.0]</key><history>7d</history><value_type>FLOAT</value_type><description>MIB: TRISTAR-MPPT
Description:Charge State
Modbus address:0x0032

0: Start
1: NightCheck
2: Disconnect
3: Night
4: Fault
5: Mppt
6: Absorption
7: Float
8: Equalize
9: Slave</description><valuemap><name>TriStar MPPT charge state</name></valuemap><preprocessing><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>battery</value></tag></tags><triggers><trigger><uuid>6c6371d2476246789d23404e068e5179</uuid><expression>last(/Morningstar TriStar MPPT by SNMP/charge.state[chargeState.0])={$CHARGE.STATE.CRIT}</expression><name>Battery: Device charge in critical state</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>65bdeac02fed4febae857f571319bf37</uuid><expression>last(/Morningstar TriStar MPPT by SNMP/charge.state[chargeState.0])={$CHARGE.STATE.WARN}</expression><name>Battery: Device charge in warning state</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><dependencies><dependency><name>Battery: Device charge in critical state</name><expression>last(/Morningstar TriStar MPPT by SNMP/charge.state[chargeState.0])={$CHARGE.STATE.CRIT}</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item><item><uuid>48db3379939b4698b8f30ff7118a9a95</uuid><name>Counter: Charge Amp-hours</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.50.0</snmp_oid><key>counter.charge_amp_hours[ahChargeResetable.0]</key><history>7d</history><value_type>FLOAT</value_type><units>Ah</units><description>MIB: TRISTAR-MPPT
Description:Ah Charge Resettable
Scaling Factor:0.1
Units:Ah
Range:[0.0, 5000]
Modbus addresses:H=0x0034 L=0x0035</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.1</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>counter</value></tag></tags></item><item><uuid>f14eb25c426141d1875d5828b5c62c30</uuid><name>Counter: Charge KW-hours</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.52.0</snmp_oid><key>counter.charge_kw_hours[kwhChargeResetable.0]</key><history>7d</history><units>!kWh</units><description>MIB: TRISTAR-MPPT
Description:kWh Charge Resettable
Scaling Factor:0.1
Units:kWh
Range:[0.0, 65535.0]
Modbus address:0x0038</description><tags><tag><tag>component</tag><value>counter</value></tag></tags></item><item><uuid>5c96236f9623495289b94bd4d63e6faf</uuid><name>Status: Alarms</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.57.0</snmp_oid><key>status.alarms[alarms.0]</key><history>1h</history><trends>0</trends><value_type>TEXT</value_type><description>MIB: TRISTAR-MPPT
Description:Faults
Modbus address:0x002c</description><preprocessing><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var FIELDS = [
  'rtsOpen',
  'rtsShorted',
  'rtsDisconnected',
  'heatsinkTempSensorOpen',
  'heatsinkTempSensorShorted',
  'highTemperatureCurrentLimit',
  'currentLimit',
  'currentOffset',
  'batterySense',
  'batterySenseDisconnected',
  'uncalibrated',
  'rtsMiswire',
  'highVoltageDisconnect',
  'undefined',
  'systemMiswire',
  'mosfetSOpen',
  'p12VoltageReferenceOff',
  'highArrayVCurrentLimit',
  'maxAdcValueReached',
  'controllerWasReset',
];

var flags = parseInt(value.replace(/\x20/g, ''), 16),
  result = [];

for (var i = 0, f = 1 &lt;&lt; 31 &gt;&gt;&gt; 0, l = FIELDS.length; i &lt; l; i++, f &gt;&gt;&gt;= 1) {
    if (flags &amp; f) {
        result.push(FIELDS[i]);
    }
}

return result.length ? result.join('\n') : 'No alarms';</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>status</value></tag></tags><triggers><trigger><uuid>b073c972bb64463aaee85c6129fad319</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;batterySense&quot;)=2</expression><name>Status: Device has &quot;batterySense&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>80a2d0a457024c22b39f0fcd45992e1e</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;batterySenseDisconnected&quot;)=2</expression><name>Status: Device has &quot;batterySenseDisconnected&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>bac1cc54818245f9baa8dc07ddc0f850</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;controllerWasReset&quot;)=2</expression><name>Status: Device has &quot;controllerWasReset&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>86c2dfb7b0984eaab02f47c58337f468</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;currentLimit&quot;)=2</expression><name>Status: Device has &quot;currentLimit&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>dd000390277a4e848a3236501817addf</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;currentOffset&quot;)=2</expression><name>Status: Device has &quot;currentOffset&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>650ecb9c06464937a3f797e73a3d756d</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;heatsinkTempSensorOpen&quot;)=2</expression><name>Status: Device has &quot;heatsinkTempSensorOpen&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>5999a4b6c49a4dabb6350d826b01e646</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;heatsinkTempSensorShorted&quot;)=2</expression><name>Status: Device has &quot;heatsinkTempSensorShorted&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>7331337c7ffb4933bca3982614657912</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;highArrayVCurrentLimit&quot;)=2</expression><name>Status: Device has &quot;highArrayVCurrentLimit&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>82a2e0adba7444c6945666fcb9430808</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;highTemperatureCurrentLimit&quot;)=2</expression><name>Status: Device has &quot;highTemperatureCurrentLimit&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>b1f6d22d205e449a811da905e679800f</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;highVoltageDisconnect&quot;)=2</expression><name>Status: Device has &quot;highVoltageDisconnect&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>e3ce50b9b696486f945ee5a4c1a7a753</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;maxAdcValueReached&quot;)=2</expression><name>Status: Device has &quot;maxAdcValueReached&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>1536cf07556b4cddb62186030a4321ca</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;mosfetSOpen&quot;)=2</expression><name>Status: Device has &quot;mosfetSOpen&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>136621f032544ea8af5e86a14ec03cb6</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;p12VoltageReferenceOff&quot;)=2</expression><name>Status: Device has &quot;p12VoltageReferenceOff&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>62ecaaf59a984b2999d13540c5220470</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;rtsDisconnected&quot;)=2</expression><name>Status: Device has &quot;rtsDisconnected&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>12037d207b3f413198594877cc7a3862</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;rtsMiswire&quot;)=2</expression><name>Status: Device has &quot;rtsMiswire&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>330f9dfe6ea34b17bcf4cac2c908d78c</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;rtsShorted&quot;)=2</expression><name>Status: Device has &quot;rtsShorted&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>fba13770ff67433489ec95d62b65d4b5</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;systemMiswire&quot;)=2</expression><name>Status: Device has &quot;systemMiswire&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>de6208b4474f4743ad99444fd7eb135d</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.alarms[alarms.0],#3,&quot;like&quot;,&quot;uncalibrated&quot;)=2</expression><name>Status: Device has &quot;uncalibrated&quot; alarm flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item><item><uuid>64a01cde330e437499a719237f68fda2</uuid><name>Status: Faults</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.55.0</snmp_oid><key>status.faults[faults.0]</key><history>1h</history><trends>0</trends><value_type>TEXT</value_type><description>MIB: TRISTAR-MPPT
Description:Faults
Modbus address:0x002c</description><preprocessing><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step><step><type>JAVASCRIPT</type><parameters><parameter>var FIELDS = [
  'overcurrent',
  'fetShort',
  'softwareFault',
  'batteryHvd',
  'arrayHvd',
  'dipSwitchChange',
  'customSettingsEdit',
  'rtsShorted',
  'rtsDisconnected',
  'eepromRetryLimit',
  'fault11Undefined',
  'slaveControlTimeout',
];

var flags = parseInt(value.replace(/\x20/g, ''), 16),
  result = [];

for (var i = 0, f = 1 &lt;&lt; 31 &gt;&gt;&gt; 0, l = FIELDS.length; i &lt; l; i++, f &gt;&gt;&gt;= 1) {
    if (flags &amp; f) {
        result.push(FIELDS[i]);
    }
}

return result.length ? result.join('\n') : 'No faults';</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>status</value></tag></tags><triggers><trigger><uuid>2a1b5a65311144d69c03255336f9f15f</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;arrayHvd&quot;)=2</expression><name>Status: Device has &quot;arrayHvd&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>f837f0839967493bb0e38b21000f5e9a</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;batteryHvd&quot;)=2</expression><name>Status: Device has &quot;batteryHvd&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>05b70b4be5554dd5ac2c65af04d79986</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;customSettingsEdit&quot;)=2</expression><name>Status: Device has &quot;customSettingsEdit&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>24ecb8842ea84a82b4d05a4e85150c55</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;dipSwitchChange&quot;)=2</expression><name>Status: Device has &quot;dipSwitchChange&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>008d82bc793b49afa6cd37d038c837fe</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;eepromRetryLimit&quot;)=2</expression><name>Status: Device has &quot;eepromRetryLimit&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>71dbbf441c234dcfbf014fc043bf5d3a</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;fetShort&quot;)=2</expression><name>Status: Device has &quot;fetShort&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>c100ec68ddaf40e6964ba2598141daa7</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;overcurrent&quot;)=2</expression><name>Status: Device has &quot;overcurrent&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>435df7ebe3e047ffada64dcf7e69148a</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;rtsDisconnected&quot;)=2</expression><name>Status: Device has &quot;rtsDisconnected&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>88443c84eaa0415db976e7a5d6c1dec4</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;rtsShorted&quot;)=2</expression><name>Status: Device has &quot;rtsShorted&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>b19111ec08094dbca30a804011b02ed2</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;slaveControlTimeout&quot;)=2</expression><name>Status: Device has &quot;slaveControlTimeout&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>0d90cab800ad4bbcbf880c157a7a9dae</uuid><expression>count(/Morningstar TriStar MPPT by SNMP/status.faults[faults.0],#3,&quot;like&quot;,&quot;softwareFault&quot;)=2</expression><name>Status: Device has &quot;softwareFault&quot; faults flag</name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item><item><uuid>5e2aebe0ce2044588636be62cde6b6a3</uuid><name>Status: Uptime (hardware)</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.25.1.1.0</snmp_oid><key>status.hw.uptime</key><history>7d</history><units>uptime</units><description>The amount of time since this host was last initialized. Note that this is different from sysUpTime in the SNMPv2-MIB [RFC1907] because sysUpTime is the uptime of the network management portion of the system.</description><preprocessing><step><type>CHECK_NOT_SUPPORTED</type><parameters><parameter/></parameters><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>0</error_handler_params></step><step><type>MULTIPLIER</type><parameters><parameter>0.01</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>status</value></tag></tags></item><item><uuid>5f1e79c9987648c8abb325a507209a07</uuid><name>Status: Uptime (network)</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.1.3.0</snmp_oid><key>status.net.uptime</key><history>7d</history><units>uptime</units><description>The time (in hundredths of a second) since the network management portion of the system was last re-initialized.</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.01</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>status</value></tag></tags><triggers><trigger><uuid>db9317cb9a6645d2bd8f4760f7579c17</uuid><expression>nodata(/Morningstar TriStar MPPT by SNMP/status.net.uptime,5m)=1</expression><name>Status: Failed to fetch data</name><event_name>Status: Failed to fetch data (or no data for 5m)</event_name><priority>WARNING</priority><description>Zabbix has not received data for items for the last 5 minutes.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item><item><uuid>c46896a6169142b59fc7f534f1981993</uuid><name>Battery: Target Voltage</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.45.0</snmp_oid><key>target.voltage[targetRegulationVoltage.0]</key><history>7d</history><value_type>FLOAT</value_type><units>V</units><description>MIB: TRISTAR-MPPT
Description:Target Voltage
Scaling Factor:0.0054931640625
Units:V
Range:[-10, 180.0]
Modbus address:0x0033</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.005493164063</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>battery</value></tag></tags></item><item><uuid>9aee4500f32a4016be4f137c948b3d67</uuid><name>Temperature: Battery</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.48.0</snmp_oid><key>temp.battery[batteryTemperature.0]</key><history>7d</history><value_type>FLOAT</value_type><units>C</units><description>MIB: TRISTAR-MPPT
Description:Batt. Temp
Scaling Factor:1.0
Units:C
Range:[-40, 80]
Modbus address:0x0025</description><tags><tag><tag>component</tag><value>temperature</value></tag></tags><triggers><trigger><uuid>5ec1c2e4786048fc889a37a12a2f4ad6</uuid><expression>min(/Morningstar TriStar MPPT by SNMP/temp.battery[batteryTemperature.0],5m)&gt;{$BATTERY.TEMP.MAX.CRIT}</expression><name>Temperature: Critically high battery temperature</name><event_name>Temperature: Critically high battery temperature (over {$BATTERY.TEMP.MAX.CRIT}C for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>84c059ff133f4f4d8145615c0a98eb50</uuid><expression>max(/Morningstar TriStar MPPT by SNMP/temp.battery[batteryTemperature.0],5m)&lt;{$BATTERY.TEMP.MIN.CRIT}</expression><name>Temperature: Critically low battery temperature</name><event_name>Temperature: Critically low battery temperature (below {$BATTERY.TEMP.MIN.WARN}C for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>11d2b988cfec425c9ffb082e9c78490d</uuid><expression>min(/Morningstar TriStar MPPT by SNMP/temp.battery[batteryTemperature.0],5m)&gt;{$BATTERY.TEMP.MAX.WARN}</expression><name>Temperature: High battery temperature</name><event_name>Temperature: High battery temperature (over {$BATTERY.TEMP.MAX.WARN}C for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><dependencies><dependency><name>Temperature: Critically high battery temperature</name><expression>min(/Morningstar TriStar MPPT by SNMP/temp.battery[batteryTemperature.0],5m)&gt;{$BATTERY.TEMP.MAX.CRIT}</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger><trigger><uuid>46122992e8a04c7bb7a8c8037a2da74a</uuid><expression>max(/Morningstar TriStar MPPT by SNMP/temp.battery[batteryTemperature.0],5m)&lt;{$BATTERY.TEMP.MIN.WARN}</expression><name>Temperature: Low battery temperature</name><event_name>Temperature: Low battery temperature (below {$BATTERY.TEMP.MIN.WARN}C for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><dependencies><dependency><name>Temperature: Critically low battery temperature</name><expression>max(/Morningstar TriStar MPPT by SNMP/temp.battery[batteryTemperature.0],5m)&lt;{$BATTERY.TEMP.MIN.CRIT}</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item><item><uuid>ffed57b626254db6bcc0df6de51d39fa</uuid><name>Temperature: Heatsink</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.49.0</snmp_oid><key>temp.heatsink[heatsinkTemperature.0]</key><history>7d</history><value_type>FLOAT</value_type><units>C</units><description>MIB: TRISTAR-MPPT
Description:HS Temp
Scaling Factor:1.0
Units:C
Range:[-40, 80]
Modbus address:0x0023</description><tags><tag><tag>component</tag><value>temperature</value></tag></tags></item></items><discovery_rules><discovery_rule><uuid>5c8910a7991240a9b586d0d87ef00d5d</uuid><name>Battery voltage discovery</name><type>DEPENDENT</type><key>battery.voltage.discovery</key><delay>0</delay><description>Discovery for battery voltage triggers</description><item_prototypes><item_prototype><uuid>763cce63817f471095bdce7a6127b0bf</uuid><name>Battery: Voltage{#SINGLETON}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.4.1.33333.2.36.0</snmp_oid><key>battery.voltage[batteryVoltage.0{#SINGLETON}]</key><history>7d</history><value_type>FLOAT</value_type><units>V</units><description>MIB: TRISTAR-MPPT
Description:Battery voltage
Scaling Factor:0.0054931640625
Units:V
Range:[-10, 180.0]
Modbus address:0x0018</description><preprocessing><step><type>MULTIPLIER</type><parameters><parameter>0.005493164063</parameter></parameters></step><step><type>REGEX</type><parameters><parameter>^(\d+)(\.\d{1,2})?</parameter><parameter>\1\2</parameter></parameters></step></preprocessing><tags><tag><tag>component</tag><value>battery</value></tag></tags><trigger_prototypes><trigger_prototype><uuid>cf9bb1b6e84d4b03b38f13c1c1d4905c</uuid><expression>min(/Morningstar TriStar MPPT by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)&gt;{#VOLTAGE.MAX.CRIT}</expression><name>Battery: Critically high battery voltage</name><event_name>Battery: Critically high battery voltage (over {#VOLTAGE.MAX.CRIT}V for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>capacity</value></tag></tags></trigger_prototype><trigger_prototype><uuid>d977ded736704d748ca49595f3658b89</uuid><expression>max(/Morningstar TriStar MPPT by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)&lt;{#VOLTAGE.MIN.CRIT}</expression><name>Battery: Critically low battery voltage</name><event_name>Battery: Critically low battery voltage (below {#VOLTAGE.MIN.CRIT}V for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>HIGH</priority><tags><tag><tag>scope</tag><value>capacity</value></tag></tags></trigger_prototype><trigger_prototype><uuid>00deb7608b3e4444bd4833f5b8ae5875</uuid><expression>min(/Morningstar TriStar MPPT by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)&gt;{#VOLTAGE.MAX.WARN}</expression><name>Battery: High battery voltage</name><event_name>Battery: High battery voltage (over {#VOLTAGE.MAX.WARN}V for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><dependencies><dependency><name>Battery: Critically high battery voltage</name><expression>min(/Morningstar TriStar MPPT by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)&gt;{#VOLTAGE.MAX.CRIT}</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>capacity</value></tag></tags></trigger_prototype><trigger_prototype><uuid>2877138cdfb0448a9a83eb807b5da24a</uuid><expression>max(/Morningstar TriStar MPPT by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)&lt;{#VOLTAGE.MIN.WARN}</expression><name>Battery: Low battery voltage</name><event_name>Battery: Low battery voltage (below {#VOLTAGE.MIN.WARN}V for 5m)</event_name><opdata>Current value: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><dependencies><dependency><name>Battery: Critically low battery voltage</name><expression>max(/Morningstar TriStar MPPT by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)&lt;{#VOLTAGE.MIN.CRIT}</expression></dependency></dependencies><tags><tag><tag>scope</tag><value>capacity</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>f95cafe8c2a744908e3a290b0b2f6252</uuid><name>Battery: Voltage{#SINGLETON}</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>battery.voltage[batteryVoltage.0{#SINGLETON}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>battery.voltage.discovery[batteryVoltage.0]</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var v_range = [
      [[0, 18], [12, 15, 11.5, 15.5]],
      [[18, 36], [24, 30, 23, 31]],
      [[36, 99], [48, 60, 46, 62]],
  ],
  result = [];

for (var idx in v_range) {
    if (v_range[idx][0][0] &lt; value &amp;&amp; value &lt;= v_range[idx][0][1]) {
        result = [{
            '{#VOLTAGE.MIN.WARN}': parseInt({$VOLTAGE.MIN.WARN}) || v_range[idx][1][0],
            '{#VOLTAGE.MAX.WARN}': parseInt({$VOLTAGE.MAX.WARN}) || v_range[idx][1][1],
            '{#VOLTAGE.MIN.CRIT}': parseInt({$VOLTAGE.MIN.CRIT}) || v_range[idx][1][2],
            '{#VOLTAGE.MAX.CRIT}': parseInt({$VOLTAGE.MAX.CRIT}) || v_range[idx][1][3],
            '{#SINGLETON}': ''
        }];
        break;
    }
}

return JSON.stringify(result);</parameter></parameters></step></preprocessing></discovery_rule></discovery_rules><tags><tag><tag>class</tag><value>power</value></tag><tag><tag>target</tag><value>morningstar</value></tag></tags><macros><macro><macro>{$BATTERY.TEMP.MAX.CRIT}</macro><value>60</value><description>Battery high temperature critical value</description></macro><macro><macro>{$BATTERY.TEMP.MAX.WARN}</macro><value>45</value><description>Battery high temperature warning value</description></macro><macro><macro>{$BATTERY.TEMP.MIN.CRIT}</macro><value>-20</value><description>Battery low temperature critical value</description></macro><macro><macro>{$BATTERY.TEMP.MIN.WARN}</macro><value>0</value><description>Battery low temperature warning value</description></macro><macro><macro>{$CHARGE.STATE.CRIT}</macro><value>4</value><description>fault</description></macro><macro><macro>{$CHARGE.STATE.WARN}</macro><value>2</value><description>disconnect</description></macro><macro><macro>{$LOAD.STATE.CRIT:&quot;fault&quot;}</macro><value>4</value><description>fault</description></macro><macro><macro>{$LOAD.STATE.CRIT:&quot;lvd&quot;}</macro><value>3</value><description>lvd</description></macro><macro><macro>{$LOAD.STATE.WARN:&quot;disconnect&quot;}</macro><value>5</value><description>disconnect</description></macro><macro><macro>{$LOAD.STATE.WARN:&quot;lvdWarning&quot;}</macro><value>2</value><description>lvdWarning</description></macro><macro><macro>{$LOAD.STATE.WARN:&quot;override&quot;}</macro><value>7</value><description>override</description></macro><macro><macro>{$VOLTAGE.MAX.CRIT}</macro></macro><macro><macro>{$VOLTAGE.MAX.WARN}</macro></macro><macro><macro>{$VOLTAGE.MIN.CRIT}</macro></macro><macro><macro>{$VOLTAGE.MIN.WARN}</macro></macro></macros><valuemaps><valuemap><uuid>3c6c60ef422c4788bf0c5b74ffab7ef0</uuid><name>TriStar MPPT charge state</name><mappings><mapping><value>0</value><newvalue>Start</newvalue></mapping><mapping><value>1</value><newvalue>NightCheck</newvalue></mapping><mapping><value>2</value><newvalue>Disconnect</newvalue></mapping><mapping><value>3</value><newvalue>Night</newvalue></mapping><mapping><value>4</value><newvalue>Fault</newvalue></mapping><mapping><value>5</value><newvalue>Mppt</newvalue></mapping><mapping><value>6</value><newvalue>Absorption</newvalue></mapping><mapping><value>7</value><newvalue>Float</newvalue></mapping><mapping><value>8</value><newvalue>Equalize</newvalue></mapping><mapping><value>9</value><newvalue>Slave</newvalue></mapping></mappings></valuemap></valuemaps></template></templates><triggers><trigger><uuid>aab5be196ac64dc69883c3109fcd094f</uuid><expression>(last(/Morningstar TriStar MPPT by SNMP/status.hw.uptime)&gt;0 and last(/Morningstar TriStar MPPT by SNMP/status.hw.uptime)&lt;10m) or (last(/Morningstar TriStar MPPT by SNMP/status.hw.uptime)=0 and last(/Morningstar TriStar MPPT by SNMP/status.net.uptime)&lt;10m)</expression><name>Status: Device has been restarted</name><event_name>Status: Device has been restarted (uptime &lt; 10m)</event_name><priority>INFO</priority><description>Uptime is less than 10 minutes.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers><graphs><graph><uuid>8cdd58f62fcc4ca89d114fbe7eddc26d</uuid><name>Array: Voltage</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>array.sweep_vmp[arrayVmpLastSweep.0]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>array.sweep_voc[arrayVocLastSweep.0]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>array.voltage[arrayVoltage.0]</key></item></graph_item></graph_items></graph><graph><uuid>067062eca2b34488a9defc3aa002c88c</uuid><name>Battery: Current</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>charge.current[batteryCurrent.0]</key></item></graph_item></graph_items></graph><graph><uuid>1889ace5679d4f63b59237812b5d0718</uuid><name>Battery: Output Power (Watts)</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>charge.output_power[ outputPower.0]</key></item></graph_item></graph_items></graph><graph><uuid>87918502df2743e1be04a02b02c44b61</uuid><name>Temperature: Battery/Heatsink</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>temp.battery[batteryTemperature.0]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Morningstar TriStar MPPT by SNMP</host><key>temp.heatsink[heatsinkTemperature.0]</key></item></graph_item></graph_items></graph></graphs></zabbix_export>
