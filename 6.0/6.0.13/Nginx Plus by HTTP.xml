<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>6.0</version><date>2023-02-11T16:14:55Z</date><groups><group><uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid><name>Templates/Applications</name></group></groups><templates><template><uuid>8cad0f2564694416b60bd8a414948641</uuid><template>Nginx Plus by HTTP</template><name>Nginx Plus by HTTP</name><description>Get Nginx Plus metrics by HTTP agent.
Metrics are collected by requests to Nginx Plus API.
Don't forget to change macros {$NGINX.API.ENDPOINT}.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Template tooling version used: 0.41</description><groups><group><name>Templates/Applications</name></group></groups><items><item><uuid>26c121f9c50a4e90b4502e2bd7f42992</uuid><name>Nginx: Get connections</name><type>HTTP_AGENT</type><key>nginx.connections</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns statistics of client connections.</description><url>{$NGINX.API.ENDPOINT}/6/connections/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>connections</value></tag><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>1734b26ca856405e8c08f222944cadc3</uuid><name>Nginx: Connections accepted, rate</name><type>DEPENDENT</type><key>nginx.connections.accepted.rate</key><delay>0</delay><history>7d</history><description>The total number of accepted client connections per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.accepted</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.connections</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>a0fd403c29e4452a9be0aecb650ab063</uuid><name>Nginx: Connections active</name><type>DEPENDENT</type><key>nginx.connections.active</key><delay>0</delay><history>7d</history><description>The current number of active client connections.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.active</parameter></parameters></step></preprocessing><master_item><key>nginx.connections</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>06395827019542b7bd381d42beb76b10</uuid><name>Nginx: Connections dropped</name><type>DEPENDENT</type><key>nginx.connections.dropped</key><delay>0</delay><history>7d</history><description>The total number of dropped client connections.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.dropped</parameter></parameters></step></preprocessing><master_item><key>nginx.connections</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags><triggers><trigger><uuid>91c9dab8147a4d0086019119e4e55b5e</uuid><expression>min(/Nginx Plus by HTTP/nginx.connections.dropped,5m) &gt; {$NGINX.DROP_RATE.MAX.WARN}</expression><name>Nginx: High connections drop rate</name><event_name>Nginx: High connections drop rate (more than {$NGINX.DROP_RATE.MAX.WARN} for 5m)</event_name><priority>WARNING</priority><description>The dropping rate connections is greater than {$NGINX.DROP_RATE.MAX.WARN} for the last 5 minutes.</description><tags><tag><tag>scope</tag><value>performance</value></tag></tags></trigger></triggers></item><item><uuid>0c0e5a2ba5f643e09d07e34d724aff9a</uuid><name>Nginx: Connections idle</name><type>DEPENDENT</type><key>nginx.connections.idle</key><delay>0</delay><history>7d</history><description>The current number of idle client connections.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.idle</parameter></parameters></step></preprocessing><master_item><key>nginx.connections</key></master_item><tags><tag><tag>component</tag><value>connections</value></tag></tags></item><item><uuid>51c50d69acdb451395736902733673fe</uuid><name>Nginx: Get HTTP location zones</name><type>HTTP_AGENT</type><key>nginx.http.location_zones</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns status information for each HTTP location zone.</description><url>{$NGINX.API.ENDPOINT}/6/http/location_zones/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>5b337c675bc14d9ab3ac6d2cf5b82dce</uuid><name>Nginx: Get HTTP zones</name><type>HTTP_AGENT</type><key>nginx.http.server_zones</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns status information for each HTTP server zone.</description><url>{$NGINX.API.ENDPOINT}/6/http/server_zones/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>raw</value></tag><tag><tag>component</tag><value>server_zones</value></tag></tags></item><item><uuid>4ec5e9b1d17141f49db5d9bf29134a49</uuid><name>Nginx: Get HTTP upstreams</name><type>HTTP_AGENT</type><key>nginx.http.upstreams</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns status of each HTTP upstream server group and its servers.</description><url>{$NGINX.API.ENDPOINT}/6/http/upstreams/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>raw</value></tag><tag><tag>component</tag><value>upstreams</value></tag></tags></item><item><uuid>d6c37400f8e64d89a698896afa6589de</uuid><name>Nginx: Get info</name><type>HTTP_AGENT</type><key>nginx.info</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Return status of nginx running instance.</description><url>{$NGINX.API.ENDPOINT}/6/nginx/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>info</value></tag><tag><tag>component</tag><value>raw</value></tag></tags></item><item><uuid>178f9f0c2ae74a6bbf1ae6965021ccde</uuid><name>Nginx: Address</name><type>DEPENDENT</type><key>nginx.info.address</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><description>The address of the server that accepted status request.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.address</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>nginx.info</key></master_item><tags><tag><tag>component</tag><value>info</value></tag></tags></item><item><uuid>14c417b374ef4674bb374979135f8617</uuid><name>Nginx: Get info error</name><type>DEPENDENT</type><key>nginx.info.error</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><description>Nginx error description.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.error.text</parameter></parameters><error_handler>CUSTOM_VALUE</error_handler></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>1h</parameter></parameters></step></preprocessing><master_item><key>nginx.info</key></master_item><tags><tag><tag>component</tag><value>health</value></tag><tag><tag>component</tag><value>info</value></tag></tags><triggers><trigger><uuid>e444c708371748bd831bba6c8d9a92e0</uuid><expression>length(last(/Nginx Plus by HTTP/nginx.info.error))&gt;0</expression><name>Nginx: Server response error</name><event_name>Nginx: Server response error (text: {ITEM.VALUE})</event_name><priority>HIGH</priority><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger></triggers></item><item><uuid>9baff3e318d84cd78c6a8ec6ae294de5</uuid><name>Nginx: Generation</name><type>DEPENDENT</type><key>nginx.info.generation</key><delay>0</delay><history>7d</history><description>The total number of configuration reloads.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.generation</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing><master_item><key>nginx.info</key></master_item><tags><tag><tag>component</tag><value>info</value></tag></tags></item><item><uuid>1baceaa7af4d45e487a448670e213c94</uuid><name>Nginx: Uptime</name><type>DEPENDENT</type><key>nginx.info.uptime</key><delay>0</delay><history>7d</history><units>uptime</units><description>Server uptime.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.load_timestamp</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step><step><type>JAVASCRIPT</type><parameters><parameter>return Math.floor((Date.now() - new Date(value)) / 1000);</parameter></parameters></step></preprocessing><master_item><key>nginx.info</key></master_item><tags><tag><tag>component</tag><value>info</value></tag></tags><triggers><trigger><uuid>396fb4be618e45578566971d5399d611</uuid><expression>nodata(/Nginx Plus by HTTP/nginx.info.uptime,30m)=1</expression><name>Nginx: Failed to fetch info data</name><event_name>Nginx: Failed to fetch info data (or no data for 30m)</event_name><priority>WARNING</priority><description>Zabbix has not received data for metrics for the last 30 minutes</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger><trigger><uuid>95622a29bd58444b9f0bd985db99f922</uuid><expression>last(/Nginx Plus by HTTP/nginx.info.uptime)&lt;10m</expression><name>Nginx: has been restarted</name><event_name>Nginx: has been restarted (uptime &lt; 10m)</event_name><priority>INFO</priority><description>Uptime is less than 10 minutes</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item><item><uuid>89059effd28641e08e2002c807784bcb</uuid><name>Nginx: Version</name><type>DEPENDENT</type><key>nginx.info.version</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><description>Version of nginx.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.version</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>nginx.info</key></master_item><tags><tag><tag>component</tag><value>info</value></tag></tags><triggers><trigger><uuid>a91ff018fe4f4a1495b08adeb2b0005f</uuid><expression>last(/Nginx Plus by HTTP/nginx.info.version,#1)&lt;&gt;last(/Nginx Plus by HTTP/nginx.info.version,#2) and length(last(/Nginx Plus by HTTP/nginx.info.version))&gt;0</expression><name>Nginx: Version has changed</name><event_name>Nginx: Version has changed (new version: {ITEM.VALUE})</event_name><priority>INFO</priority><description>Nginx version has changed. Ack to close.</description><manual_close>YES</manual_close><tags><tag><tag>scope</tag><value>notice</value></tag></tags></trigger></triggers></item><item><uuid>65377fc7308340348199c4c63720a7e1</uuid><name>Nginx: Get requests</name><type>HTTP_AGENT</type><key>nginx.requests</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns status of client HTTP requests.</description><url>{$NGINX.API.ENDPOINT}/6/http/requests/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>raw</value></tag><tag><tag>component</tag><value>requests</value></tag></tags></item><item><uuid>630c4f81f9f44397a156e2d4e5d21af8</uuid><name>Nginx: Requests current</name><type>DEPENDENT</type><key>nginx.requests.current</key><delay>0</delay><history>7d</history><description>The current number of client requests.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.current</parameter></parameters></step></preprocessing><master_item><key>nginx.requests</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag></tags></item><item><uuid>8130bfb659a94641b97a1abcdb9a4f66</uuid><name>Nginx: Requests total, rate</name><type>DEPENDENT</type><key>nginx.requests.total.rate</key><delay>0</delay><history>7d</history><description>The total number of client requests per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.total</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.requests</key></master_item><tags><tag><tag>component</tag><value>requests</value></tag></tags></item><item><uuid>9ea35f4f2ca24187896b7f44fb410d24</uuid><name>Nginx: Get resolvers</name><type>HTTP_AGENT</type><key>nginx.resolvers</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns status information for each resolver zone.</description><url>{$NGINX.API.ENDPOINT}/6/resolvers/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>raw</value></tag><tag><tag>component</tag><value>resolvers</value></tag></tags></item><item><uuid>e0798bb2d16c418781e19880fd78832c</uuid><name>Nginx: Get SSL</name><type>HTTP_AGENT</type><key>nginx.ssl</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns SSL statistics.</description><url>{$NGINX.API.ENDPOINT}/6/ssl/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>raw</value></tag><tag><tag>component</tag><value>ssl</value></tag></tags></item><item><uuid>09c7ab8555d046a69a96889185650dfe</uuid><name>Nginx: SSL handshakes, rate</name><type>DEPENDENT</type><key>nginx.ssl.handshakes.rate</key><delay>0</delay><history>7d</history><description>The total number of successful SSL handshakes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.handshakes</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.ssl</key></master_item><tags><tag><tag>component</tag><value>ssl</value></tag></tags></item><item><uuid>77fcc55ced2045e099b37580f7ef6d5b</uuid><name>Nginx: SSL handshakes failed, rate</name><type>DEPENDENT</type><key>nginx.ssl.handshakes_failed.rate</key><delay>0</delay><history>7d</history><description>The total number of failed SSL handshakes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.handshakes_failed</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.ssl</key></master_item><tags><tag><tag>component</tag><value>ssl</value></tag></tags></item><item><uuid>98ec8bec834a42caba8d260d939beb0e</uuid><name>Nginx: SSL session reuses, rate</name><type>DEPENDENT</type><key>nginx.ssl.session_reuses.rate</key><delay>0</delay><history>7d</history><description>The total number of session reuses during SSL handshake per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$.session_reuses</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.ssl</key></master_item><tags><tag><tag>component</tag><value>ssl</value></tag></tags></item><item><uuid>148a8612964b445ba37e340c9341f49d</uuid><name>Nginx: Get Stream server zones</name><type>HTTP_AGENT</type><key>nginx.stream.server_zones</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns status information for each stream server zone.</description><url>{$NGINX.API.ENDPOINT}/6/stream/server_zones/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>raw</value></tag><tag><tag>component</tag><value>server_zones</value></tag></tags></item><item><uuid>c48ca144a8414b2db1c35d518ca5a24f</uuid><name>Nginx: Get Stream upstreams</name><type>HTTP_AGENT</type><key>nginx.stream.upstreams</key><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Returns status of each stream upstream server group and its servers.</description><url>{$NGINX.API.ENDPOINT}/6/stream/upstreams/</url><status_codes>200,404</status_codes><tags><tag><tag>component</tag><value>raw</value></tag><tag><tag>component</tag><value>upstreams</value></tag></tags></item></items><discovery_rules><discovery_rule><uuid>33fdb45a55544c628c0106ed193ebc0b</uuid><name>HTTP location zones discovery</name><type>DEPENDENT</type><key>nginx.http.location_zones.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.HTTP.LOCATION.ZONE.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.HTTP.LOCATION.ZONE.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>e75bc85680534ec18df16b9e69bc248c</uuid><name>Nginx: HTTP location zone [{#NAME}]: Discarded, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.discarded.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of requests completed without sending a response per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].discarded</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>17e01c9171bd493f98b37811dcf49802</uuid><name>Nginx: HTTP location zone [{#NAME}]: Received, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.received.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of bytes received from clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].received</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>c646c18580ef4b8695cbc03ce0d5122d</uuid><name>Nginx: HTTP location zone [{#NAME}]: Requests, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.requests.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of client requests received from clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].requests</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>82c9f68d10ec47f1a701eee692e3b9ae</uuid><name>Nginx: HTTP location zone [{#NAME}]: Responses 1xx, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.responses.1xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “1xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.1xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>0cedd14450ba44f0b4c026afabb522a9</uuid><name>Nginx: HTTP location zone [{#NAME}]: Responses 2xx, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.responses.2xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “2xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.2xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>046a2a3b9a644dc1b4a0078b6722c867</uuid><name>Nginx: HTTP location zone [{#NAME}]: Responses 3xx, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.responses.3xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “3xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.3xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>32eb7cb8f04044d6a00ead678ff44a00</uuid><name>Nginx: HTTP location zone [{#NAME}]: Responses 4xx, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.responses.4xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “4xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.4xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>dd5a27eb32da42d7998f89a96e29304f</uuid><name>Nginx: HTTP location zone [{#NAME}]: Responses 5xx, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.responses.5xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “5xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.5xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>b6e3c7f074b54531aa57dce55169aedd</uuid><name>Nginx: HTTP location zone [{#NAME}]: Responses total, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.responses.total.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of responses sent to clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.total</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>0af45d37b3a24d5491054aa3cf319315</uuid><name>Nginx: HTTP location zone [{#NAME}]: Sent, rate</name><type>DEPENDENT</type><key>nginx.http.location_zones.sent.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of bytes sent to clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].sent</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.location_zones</key></master_item><tags><tag><tag>component</tag><value>location_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>85880c097a1c47bfafa35de05304abbc</uuid><name>Nginx: HTTP location zone [{#NAME}]: Requests</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.location_zones.requests.rate[{#NAME}]</key></item></graph_item></graph_items></graph_prototype><graph_prototype><uuid>6b05907e4c544986b977a1b496ca92e2</uuid><name>Nginx: HTTP location zone [{#NAME}]: Responses</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.location_zones.responses.2xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.location_zones.responses.1xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.location_zones.responses.3xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>3</sortorder><drawtype>GRADIENT_LINE</drawtype><color>A54F10</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.location_zones.responses.4xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>4</sortorder><drawtype>GRADIENT_LINE</drawtype><color>FC6EA3</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.location_zones.responses.5xx.rate[{#NAME}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>nginx.http.location_zones</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var output = [];

Object.keys(JSON.parse(value)).forEach(function (v) {
    output.push({ '{#NAME}': v })
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>85ad3fc40daa45b7a2fe00d570c5626c</uuid><name>HTTP server zones discovery</name><type>DEPENDENT</type><key>nginx.http.server_zones.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.HTTP.ZONE.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.HTTP.ZONE.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>46d056a7870545e49db03b0ec2bd1e9b</uuid><name>Nginx: HTTP server zone [{#NAME}]: Discarded, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.discarded.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of requests completed without sending a response per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].discarded</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>e8dd5302fced4d23ba93656f383222d9</uuid><name>Nginx: HTTP server zone [{#NAME}]: Processing</name><type>DEPENDENT</type><key>nginx.http.server_zones.processing[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of client requests that are currently being processed.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].processing</parameter></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>edc834403218460b8c7b8b3ca0709a76</uuid><name>Nginx: HTTP server zone [{#NAME}]: Received, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.received.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of bytes received from clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].received</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>e33079d5cc684a5687bd7cd10eaec541</uuid><name>Nginx: HTTP server zone [{#NAME}]: Requests, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.requests.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of client requests received from clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].requests</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>2b37ee1a3c1243c38534f70acf7a32d9</uuid><name>Nginx: HTTP server zone [{#NAME}]: Responses 1xx, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.responses.1xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “1xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.1xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>4e127d8bfac940f1b3703053ada05fbd</uuid><name>Nginx: HTTP server zone [{#NAME}]: Responses 2xx, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.responses.2xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “2xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.2xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>6add98c2b5334160a0e4cc363f53cb7e</uuid><name>Nginx: HTTP server zone [{#NAME}]: Responses 3xx, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.responses.3xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “3xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.3xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>1f2cd6dcddf948a9bf17f05c68502f46</uuid><name>Nginx: HTTP server zone [{#NAME}]: Responses 4xx, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.responses.4xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “4xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.4xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>fc6654f2627e47cbbe1a7628c073520a</uuid><name>Nginx: HTTP server zone [{#NAME}]: Responses 5xx, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.responses.5xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of responses with “5xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.5xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>fd81275f0c994a62a9412d595d7d2e8b</uuid><name>Nginx: HTTP server zone [{#NAME}]: Responses total, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.responses.total.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of responses sent to clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.total</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>91acfc8de0e64d52820d509ced251e5b</uuid><name>Nginx: HTTP server zone [{#NAME}]: Sent, rate</name><type>DEPENDENT</type><key>nginx.http.server_zones.sent.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of bytes sent to clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].sent</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>ba4bc0201f0741078e1512fd79bddf59</uuid><name>Nginx: HTTP server zone [{#NAME}]: Requests</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.server_zones.requests.rate[{#NAME}]</key></item></graph_item></graph_items></graph_prototype><graph_prototype><uuid>5870e9a861f046b3946c2464c6c5007d</uuid><name>Nginx: HTTP server zone [{#NAME}]: Responses</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.server_zones.responses.2xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.server_zones.responses.1xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.server_zones.responses.3xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>3</sortorder><drawtype>GRADIENT_LINE</drawtype><color>A54F10</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.server_zones.responses.4xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>4</sortorder><drawtype>GRADIENT_LINE</drawtype><color>FC6EA3</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.server_zones.responses.5xx.rate[{#NAME}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>nginx.http.server_zones</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var output = [];

Object.keys(JSON.parse(value)).forEach(function (v) {
    output.push({ '{#NAME}': v })
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>007e9b12e7164f629d90a6f377333dc8</uuid><name>HTTP upstream peers discovery</name><type>DEPENDENT</type><key>nginx.http.upstream.peers.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#UPSTREAM}</macro><value>{$NGINX.LLD.FILTER.HTTP.UPSTREAM.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#UPSTREAM}</macro><value>{$NGINX.LLD.FILTER.HTTP.UPSTREAM.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>ad270fab134c44ae83c154670db4d317</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Active</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.active[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The current number of active connections.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].active.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>cd7455016ac549598df2551a716545ef</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Fails, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.fails.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of unsuccessful attempts to communicate with the server per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].fails.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>b0607f003d7a4713a28f0d75b7933087</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Header time</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.header_time.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><units>!ms</units><description>The average time to get the response header from the server.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].header_time.first()</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>89f89850409a4aff8447b9f7c2839f01</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks, check</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.health_checks.checks[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of health check requests made.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].health_checks.checks.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>31292e9dbc8c45dd936ed1e77d44940b</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks, fails</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.health_checks.fails[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The number of failed health checks.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].health_checks.fails.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>89c57fb94cab4635b14532961560a8bf</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks, unhealthy</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.health_checks.unhealthy[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>How many times the server became unhealthy (state “unhealthy”).</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].health_checks.unhealthy.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>8731deb89d1c4fc2bab90aca5802c721</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Received, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.received.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of bytes received from this server per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].received.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>3ff18cfb4028421e9af0460aeaa2d6a4</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Requests, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.requests.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of client requests forwarded to this server per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].requests.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>6ca38995050e44488df4fde7dc543541</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Responses 1xx, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.responses.1xx.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The number of responses with “1xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].responses.1xx.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>e526b61c48eb45568ef92434eee3a2cb</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Responses 2xx, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.responses.2xx.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The number of responses with “2xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].responses.2xx.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>7b2851137d77418a8548e92332c66c86</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Responses 3xx, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.responses.3xx.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The number of responses with “3xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].responses.3xx.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>cb81f113d289409ca26af48aeb68f8cc</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Responses 4xx, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.responses.4xx.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The number of responses with “4xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].responses.4xx.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>172cb81d02f04fd48c7b82d8ae7dac69</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Responses 5xx, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.responses.5xx.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The number of responses with “5xx” status codes per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].responses.5xx.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>d587254989c743b4aa9c8043bf18baa5</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Responses total, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.responses.total.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of responses obtained from this server.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].responses.total.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>868562df5ab44d3cadeb6fa294b33559</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Response time</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.response_time.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><units>!ms</units><description>The average time to get the full response from the server.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].response_time.first()</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>2a0a36d22acf453e80d79820990db9b8</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Sent, rate</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.sent.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of bytes sent to this server per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].sent.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>33eacaa48f974c348e37475341a6c8af</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: State</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.state[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><description>Current state, which may be one of “up”, “draining”, “down”, “unavail”, “checking”, and “unhealthy”.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].state.first()</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags><trigger_prototypes><trigger_prototype><uuid>fc6586fe2eef457bac1d71ce0313f95d</uuid><expression>find(/Nginx Plus by HTTP/nginx.http.upstream.peer.state[{#UPSTREAM},{#PEER}],,&quot;like&quot;,&quot;up&quot;)=0 and find(/Nginx Plus by HTTP/nginx.http.upstream.peer.state[{#UPSTREAM},{#PEER}],,&quot;like&quot;,&quot;down&quot;)=0</expression><name>Nginx: HTTP upstream server is not in UP or DOWN state.</name><opdata>Current state: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><uuid>e89e6c141217465794febd9131ccafae</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Unavail</name><type>DEPENDENT</type><key>nginx.http.upstream.peer.unavail.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>How many times the server became unavailable for client requests (state “unavail”) due to the number of unsuccessful attempts reaching the max_fails threshold.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].unavail.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><trigger_prototypes><trigger_prototype><uuid>e7b4782a796b4710b50a96f3d24c8208</uuid><expression>sum(/Nginx Plus by HTTP/nginx.http.upstream.peer.responses.4xx.rate[{#UPSTREAM},{#PEER}],5m) &gt; (sum(/Nginx Plus by HTTP/nginx.http.upstream.peer.responses.total.rate[{#UPSTREAM},{#PEER}],5m)*({$NGINX.HTTP.UPSTREAM.4XX.MAX.WARN}/100))</expression><name>Nginx: Too many HTTP requests with code 4xx</name><event_name>Nginx: Too many HTTP requests with code 4xx (over {$NGINX.HTTP.UPSTREAM.4XX.MAX.WARN}% for 5m)</event_name><priority>WARNING</priority><tags><tag><tag>scope</tag><value>performance</value></tag></tags></trigger_prototype><trigger_prototype><uuid>f542573d149547d3844f635bf2a87120</uuid><expression>sum(/Nginx Plus by HTTP/nginx.http.upstream.peer.responses.5xx.rate[{#UPSTREAM},{#PEER}],5m) &gt; (sum(/Nginx Plus by HTTP/nginx.http.upstream.peer.responses.total.rate[{#UPSTREAM},{#PEER}],5m)*({$NGINX.HTTP.UPSTREAM.5XX.MAX.WARN}/100))</expression><name>Nginx: Too many HTTP requests with code 5xx</name><event_name>Nginx: Too many HTTP requests with code 5xx (over {$NGINX.HTTP.UPSTREAM.5XX.MAX.WARN}% for 5m)</event_name><priority>HIGH</priority><tags><tag><tag>scope</tag><value>performance</value></tag></tags></trigger_prototype></trigger_prototypes><graph_prototypes><graph_prototype><uuid>63582bcbe4c741e88cd64a43ff1b7d9d</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.health_checks.checks[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.health_checks.fails[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.health_checks.unhealthy[{#UPSTREAM},{#PEER}]</key></item></graph_item></graph_items></graph_prototype><graph_prototype><uuid>49cd8f25969d486ab4482b4986b1815a</uuid><name>Nginx: HTTP upstream [{#UPSTREAM}] peer [{#PEER}]: Responses</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.responses.2xx.rate[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.responses.1xx.rate[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.responses.3xx.rate[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>3</sortorder><drawtype>GRADIENT_LINE</drawtype><color>A54F10</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.responses.4xx.rate[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>4</sortorder><drawtype>GRADIENT_LINE</drawtype><color>FC6EA3</color><item><host>Nginx Plus by HTTP</host><key>nginx.http.upstream.peer.responses.5xx.rate[{#UPSTREAM},{#PEER}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>nginx.http.upstreams</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var input = JSON.parse(value),
    output = [];

Object.keys(input).forEach(function (upstream) {
    input[upstream].peers.forEach(function (peer) {
        output.push({ '{#UPSTREAM}': upstream, '{#PEER}': peer.server })
    });
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>0cdb09e9004540239fd49eab09e3f324</uuid><name>HTTP upstreams discovery</name><type>DEPENDENT</type><key>nginx.http.upstreams.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.HTTP.UPSTREAM.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.HTTP.UPSTREAM.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>ef9a2a71c3a340c894f82c29503d6b6b</uuid><name>Nginx: HTTP upstream [{#NAME}]: Keepalive</name><type>DEPENDENT</type><key>nginx.http.upstreams.keepalive[{#NAME}]</key><delay>0</delay><history>7d</history><description>The current number of idle keepalive connections.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].keepalive</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstreams</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>1a426d42dada4eb082aa4e912ae1256c</uuid><name>Nginx: HTTP upstream [{#NAME}]: Zombies</name><type>DEPENDENT</type><key>nginx.http.upstreams.zombies[{#NAME}]</key><delay>0</delay><history>7d</history><description>The current number of servers removed from the group but still processing active client requests.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].zombies</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstreams</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>8aa415f2a55a4e8fb28ea87a8d307bd4</uuid><name>Nginx: HTTP upstream [{#NAME}]: Zone</name><type>DEPENDENT</type><key>nginx.http.upstreams.zone[{#NAME}]</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><description>The name of the shared memory zone that keeps the group's configuration and run-time state.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].zone</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>nginx.http.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstreams</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><master_item><key>nginx.http.upstreams</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var output = [];

Object.keys(JSON.parse(value)).forEach(function (v) {
    output.push({ '{#NAME}': v })
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>1f75b67c7c4044dfa8727cc7363e86d0</uuid><name>Resolvers discovery</name><type>DEPENDENT</type><key>nginx.resolvers.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.RESOLVER.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.RESOLVER.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>8fd2a1c5c148423886dccb939ca61b62</uuid><name>Nginx: Resolver [{#NAME}]: Requests addr, rate</name><type>DEPENDENT</type><key>nginx.resolvers.requests.addr.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of requests to resolve addresses to names per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].requests.addr</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>fb149324f11a4edc9971e9e2572282a6</uuid><name>Nginx: Resolver [{#NAME}]: Requests name, rate</name><type>DEPENDENT</type><key>nginx.resolvers.requests.name.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of requests to resolve names to addresses per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].requests.name</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>9ebd08e8b6a3416c940b16a03158bafe</uuid><name>Nginx: Resolver [{#NAME}]: Requests srv, rate</name><type>DEPENDENT</type><key>nginx.resolvers.requests.srv.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of requests to resolve SRV records per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].requests.srv</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>8a7db7d9c24f4f88b9ad9dde32b2b2e0</uuid><name>Nginx: Resolver [{#NAME}]: Responses formerr, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.formerr.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of FORMERR (Format error) responses per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.formerr</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>bf5a55d771724cfeaec90950f653b181</uuid><name>Nginx: Resolver [{#NAME}]: Responses noerror, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.noerror.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of successful responses per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.noerror</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>46cd31140a3342568c7d7ae0cdae6270</uuid><name>Nginx: Resolver [{#NAME}]: Responses notimp, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.notimp.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of NOTIMP (Unimplemented) responses per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.notimp</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>b4e002955de844a69a755076993b0577</uuid><name>Nginx: Resolver [{#NAME}]: Responses nxdomain, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.nxdomain.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of NXDOMAIN (Host not found) responses per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.nxdomain</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>114f260fc9754e80927494dce51f9e46</uuid><name>Nginx: Resolver [{#NAME}]: Responses refused, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.refused.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of REFUSED (Operation refused) responses per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.refused</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>7b4f4f609807407e849525f9f99c0fcc</uuid><name>Nginx: Resolver [{#NAME}]: Responses servfail, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.servfail.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of SERVFAIL (Server failure) responses per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.servfail</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>28b11b8bfd6143ada94b041390281a2f</uuid><name>Nginx: Resolver [{#NAME}]: Responses timedout, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.timedout.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of timed out requests per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.timedout</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>b68f19ad119941b58da491d2cd827277</uuid><name>Nginx: Resolver [{#NAME}]: Responses unknown, rate</name><type>DEPENDENT</type><key>nginx.resolvers.responses.unknown.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of requests completed with an unknown error per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].responses.unknown</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.resolvers</key></master_item><tags><tag><tag>component</tag><value>resolver</value></tag><tag><tag>resolver</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>7c91ca5b8477468fa19c56b621e0c32a</uuid><name>Nginx: Resolver [{#NAME}]: Requests</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.requests.name.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.requests.srv.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.requests.addr.rate[{#NAME}]</key></item></graph_item></graph_items></graph_prototype><graph_prototype><uuid>e3535ce974114e6188752937c1bdb2c7</uuid><name>Nginx: Resolver [{#NAME}]: Responses</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.noerror.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.formerr.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.servfail.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>3</sortorder><drawtype>GRADIENT_LINE</drawtype><color>A54F10</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.nxdomain.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>4</sortorder><drawtype>GRADIENT_LINE</drawtype><color>FC6EA3</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.notimp.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>5</sortorder><drawtype>GRADIENT_LINE</drawtype><color>6C59DC</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.refused.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>6</sortorder><drawtype>GRADIENT_LINE</drawtype><color>AC8C14</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.timedout.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>7</sortorder><drawtype>GRADIENT_LINE</drawtype><color>611F27</color><item><host>Nginx Plus by HTTP</host><key>nginx.resolvers.responses.unknown.rate[{#NAME}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>nginx.resolvers</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var output = [];

Object.keys(JSON.parse(value)).forEach(function (v) {
    output.push({ '{#NAME}': v })
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>bdc6582408be488997720ef8a4d1108e</uuid><name>Stream server zones discovery</name><type>DEPENDENT</type><key>nginx.stream.server_zones.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.STREAM.ZONE.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.STREAM.ZONE.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>e321037e23ff484cb4dc89a8e187919c</uuid><name>Nginx: Stream server zone [{#NAME}]: Connections, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.connections.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of connections accepted from clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].connections</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>c9e9d883123842d291c922d5bbcca8f3</uuid><name>Nginx: Stream server zone [{#NAME}]: Discarded, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.discarded.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of connections completed without creating a session per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].discarded</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>f8d16f41fe9e4be685c28bb4acd2187f</uuid><name>Nginx: Stream server zone [{#NAME}]: Processing</name><type>DEPENDENT</type><key>nginx.stream.server_zones.processing[{#NAME}]</key><delay>0</delay><history>7d</history><description>The number of client connections that are currently being processed.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].processing</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>47a9959627e3423e9739b55dac23edd2</uuid><name>Nginx: Stream server zone [{#NAME}]: Received, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.received.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of bytes received from clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].received</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>2aafb1ae6ce24f14a3494826d63cfce2</uuid><name>Nginx: Stream server zone [{#NAME}]: Sent, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.sent.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of bytes sent to clients per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].sent</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>7399335b883040c495b5cbfade3e182e</uuid><name>Nginx: Stream server zone [{#NAME}]: Sessions 2xx, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.sessions.2xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of sessions completed with status codes “2xx” per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].sessions.2xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>5e654682849748bea849db9ab73f7075</uuid><name>Nginx: Stream server zone [{#NAME}]: Sessions 4xx, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.sessions.4xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of sessions completed with status codes “4xx” per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].sessions.4xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>0cdc4545f6dc4a1e8f247291302824a4</uuid><name>Nginx: Stream server zone [{#NAME}]: Sessions 5xx, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.sessions.5xx.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of sessions completed with status codes “5xx” per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].sessions.5xx</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>30313c91655042b8948422c13fbdfca3</uuid><name>Nginx: Stream server zone [{#NAME}]: Sessions total, rate</name><type>DEPENDENT</type><key>nginx.stream.server_zones.sessions.total.rate[{#NAME}]</key><delay>0</delay><history>7d</history><description>The total number of completed client sessions per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].sessions.total</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.server_zones</key></master_item><tags><tag><tag>component</tag><value>server_zones</value></tag><tag><tag>zone</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>f833112506e941d791057925c58bd1d9</uuid><name>Nginx: Stream server zone [{#NAME}]: Sessions</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.stream.server_zones.sessions.2xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.stream.server_zones.sessions.4xx.rate[{#NAME}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.stream.server_zones.sessions.5xx.rate[{#NAME}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>nginx.stream.server_zones</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var output = [];

Object.keys(JSON.parse(value)).forEach(function (v) {
    output.push({ '{#NAME}': v })
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>435f8bc40dd244aabb7daee4be7d54e5</uuid><name>Stream upstream peers discovery</name><type>DEPENDENT</type><key>nginx.stream.upstream.peers.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#UPSTREAM}</macro><value>{$NGINX.LLD.FILTER.STREAM.UPSTREAM.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#UPSTREAM}</macro><value>{$NGINX.LLD.FILTER.STREAM.UPSTREAM.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>3337df557e734de8b019216c5c06fcea</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Active</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.active[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The current number of connections.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].active.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>2ae319abd31b40b7a765c300e5dfa954</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Connections</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.connections.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of client connections forwarded to this server.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].connections.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>f98409ef166b47f3a70d46dffe233166</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Connect time</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.connect_time.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><units>!ms</units><description>The average time to connect to the upstream server.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].connect_time.first()</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>0b1000ddc883422cb9fb3382a839c10a</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Fails, rate</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.fails.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of unsuccessful attempts to communicate with the server per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].fails.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>23a02d1c0a63483fb1eb4914a7e48ecf</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: First byte time</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.first_byte_time.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><units>!ms</units><description>The average time to receive the first byte of data.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].first_byte_time.first()</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>dac0196daad74fc385a336c7dbddbcfd</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks, check</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.health_checks.checks[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of health check requests made.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].health_checks.checks.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>af2a6991b432439cb4afb071974a05e7</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks, fails</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.health_checks.fails[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The number of failed health checks.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].health_checks.fails.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>089bbb9c602a4654a3d2c582c643745f</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks, unhealthy</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.health_checks.unhealthy[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>How many times the server became unhealthy (state “unhealthy”).</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].health_checks.unhealthy.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>12193b1723eb419a9bbcb235c7b45308</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Received, rate</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.received.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of bytes received from this server per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].received.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>bda851b725454395b59988f03c534b3b</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Response time</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.response_time.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><units>!ms</units><description>The average time to receive the last byte of data.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].response_time.first()</parameter></parameters><error_handler>DISCARD_VALUE</error_handler></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>6ae8685716cf487fa72534a76e4b286a</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Sent, rate</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.sent.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>The total number of bytes sent to this server per second.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].sent.first()</parameter></parameters></step><step><type>CHANGE_PER_SECOND</type><parameters><parameter/></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype><item_prototype><uuid>ae7b6564244845518816fffc38bbf9aa</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: State</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.state[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><description>Current state, which may be one of “up”, “draining”, “down”, “unavail”, “checking”, and “unhealthy”.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].state.first()</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags><trigger_prototypes><trigger_prototype><uuid>20ef9b9e953246ef856dd46033595e52</uuid><expression>find(/Nginx Plus by HTTP/nginx.stream.upstream.peer.state[{#UPSTREAM},{#PEER}],,&quot;like&quot;,&quot;up&quot;)=0 and find(/Nginx Plus by HTTP/nginx.stream.upstream.peer.state[{#UPSTREAM},{#PEER}],,&quot;like&quot;,&quot;down&quot;)=0</expression><name>Nginx: Stream upstream server is not in UP or DOWN state.</name><opdata>Current state: {ITEM.LASTVALUE1}</opdata><priority>WARNING</priority><tags><tag><tag>scope</tag><value>availability</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><uuid>732f0ea262454ab3a4cfeb09aea66b9b</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Unavail</name><type>DEPENDENT</type><key>nginx.stream.upstream.peer.unavail.rate[{#UPSTREAM},{#PEER}]</key><delay>0</delay><history>7d</history><description>How many times the server became unavailable for client requests (state “unavail”) due to the number of unsuccessful attempts reaching the max_fails threshold.</description><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#UPSTREAM}'].peers[?(@.server == '{#PEER}')].unavail.first()</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstream</value></tag><tag><tag>peer</tag><value>{#PEER}</value></tag><tag><tag>upstream</tag><value>{#UPSTREAM}</value></tag></tags></item_prototype></item_prototypes><graph_prototypes><graph_prototype><uuid>abb23d681d0a461db00648b412b176c8</uuid><name>Nginx: Stream upstream [{#UPSTREAM}] peer [{#PEER}]: Health checks</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.stream.upstream.peer.health_checks.checks[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.stream.upstream.peer.health_checks.fails[{#UPSTREAM},{#PEER}]</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.stream.upstream.peer.health_checks.unhealthy[{#UPSTREAM},{#PEER}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes><master_item><key>nginx.stream.upstreams</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var input = JSON.parse(value),
    output = [];

Object.keys(input).forEach(function (upstream) {
    input[upstream].peers.forEach(function (peer) {
        output.push({ '{#UPSTREAM}': upstream, '{#PEER}': peer.server })
    });
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule><discovery_rule><uuid>8a8f9d8b47f84bd98a5315ae30944240</uuid><name>Stream upstreams discovery</name><type>DEPENDENT</type><key>nginx.stream.upstreams.discovery</key><delay>0</delay><filter><evaltype>AND</evaltype><conditions><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.STREAM.UPSTREAM.MATCHES}</value><formulaid>A</formulaid></condition><condition><macro>{#NAME}</macro><value>{$NGINX.LLD.FILTER.STREAM.UPSTREAM.NOT_MATCHES}</value><operator>NOT_MATCHES_REGEX</operator><formulaid>B</formulaid></condition></conditions></filter><item_prototypes><item_prototype><uuid>5537680fbc024713a077932cc55ef3a7</uuid><name>Nginx: Stream upstream [{#NAME}]: Zombies</name><type>DEPENDENT</type><key>nginx.stream.upstreams.zombies[{#NAME}]</key><delay>0</delay><history>7d</history><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].zombies</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstreams</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype><item_prototype><uuid>8c273c10ece545a58e4d34f6d3812fe0</uuid><name>Nginx: Stream upstream [{#NAME}]: Zone</name><type>DEPENDENT</type><key>nginx.stream.upstreams.zone[{#NAME}]</key><delay>0</delay><history>7d</history><trends>0</trends><value_type>CHAR</value_type><preprocessing><step><type>JSONPATH</type><parameters><parameter>$['{#NAME}'].zone</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>3h</parameter></parameters></step></preprocessing><master_item><key>nginx.stream.upstreams</key></master_item><tags><tag><tag>component</tag><value>upstreams</value></tag><tag><tag>upstream</tag><value>{#NAME}</value></tag></tags></item_prototype></item_prototypes><master_item><key>nginx.stream.upstreams</key></master_item><preprocessing><step><type>JAVASCRIPT</type><parameters><parameter>var output = [];

Object.keys(JSON.parse(value)).forEach(function (v) {
    output.push({ '{#NAME}': v })
});

return JSON.stringify(output);</parameter></parameters></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><parameters><parameter>30m</parameter></parameters></step></preprocessing></discovery_rule></discovery_rules><tags><tag><tag>class</tag><value>software</value></tag><tag><tag>target</tag><value>nginx</value></tag></tags><macros><macro><macro>{$NGINX.API.ENDPOINT}</macro><description>NGINX Plus API URL in the format `&lt;scheme&gt;://&lt;host&gt;:&lt;port&gt;/&lt;location&gt;/`</description></macro><macro><macro>{$NGINX.DROP_RATE.MAX.WARN}</macro><value>1</value><description>The critical rate of the dropped connections for trigger expression.</description></macro><macro><macro>{$NGINX.HTTP.UPSTREAM.4XX.MAX.WARN}</macro><value>5</value><description>Maximum percentage of errors with status code 4xx (for trigger expression).</description></macro><macro><macro>{$NGINX.HTTP.UPSTREAM.5XX.MAX.WARN}</macro><value>5</value><description>Maximum percentage of errors with status code 4xx (for trigger expression).</description></macro><macro><macro>{$NGINX.LLD.FILTER.HTTP.LOCATION.ZONE.MATCHES}</macro><value>.*</value><description>Filter of discoverable HTTP location zones</description></macro><macro><macro>{$NGINX.LLD.FILTER.HTTP.LOCATION.ZONE.NOT_MATCHES}</macro><value>CHANGE_IF_NEEDED</value><description>Filter to exclude discovered HTTP location zones</description></macro><macro><macro>{$NGINX.LLD.FILTER.HTTP.UPSTREAM.MATCHES}</macro><value>.*</value><description>Filter of discoverable HTTP upstreams</description></macro><macro><macro>{$NGINX.LLD.FILTER.HTTP.UPSTREAM.NOT_MATCHES}</macro><value>CHANGE_IF_NEEDED</value><description>Filter to exclude discovered HTTP upstreams</description></macro><macro><macro>{$NGINX.LLD.FILTER.HTTP.ZONE.MATCHES}</macro><value>.*</value><description>Filter of discoverable HTTP server zones</description></macro><macro><macro>{$NGINX.LLD.FILTER.HTTP.ZONE.NOT_MATCHES}</macro><value>CHANGE_IF_NEEDED</value><description>Filter to exclude discovered HTTP server zones</description></macro><macro><macro>{$NGINX.LLD.FILTER.RESOLVER.MATCHES}</macro><value>.*</value><description>Filter of discoverable Resolvers</description></macro><macro><macro>{$NGINX.LLD.FILTER.RESOLVER.NOT_MATCHES}</macro><value>CHANGE_IF_NEEDED</value><description>Filter to exclude discovered Resolvers</description></macro><macro><macro>{$NGINX.LLD.FILTER.STREAM.UPSTREAM.MATCHES}</macro><value>.*</value><description>Filter of discoverable Stream upstreams</description></macro><macro><macro>{$NGINX.LLD.FILTER.STREAM.UPSTREAM.NOT_MATCHES}</macro><value>CHANGE_IF_NEEDED</value><description>Filter to exclude discovered Stream upstreams</description></macro><macro><macro>{$NGINX.LLD.FILTER.STREAM.ZONE.MATCHES}</macro><value>.*</value><description>Filter of discoverable Stream server zones</description></macro><macro><macro>{$NGINX.LLD.FILTER.STREAM.ZONE.NOT_MATCHES}</macro><value>CHANGE_IF_NEEDED</value><description>Filter to exclude discovered Stream server zones</description></macro></macros></template></templates><graphs><graph><uuid>a8b239f2f21a471fa3ac6a10a0419e9c</uuid><name>Nginx: Connections</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.connections.accepted.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.connections.dropped</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.connections.active</key></item></graph_item><graph_item><sortorder>3</sortorder><drawtype>GRADIENT_LINE</drawtype><color>A54F10</color><item><host>Nginx Plus by HTTP</host><key>nginx.connections.idle</key></item></graph_item></graph_items></graph><graph><uuid>4be7153e244b4c28a53c527aa9fd5706</uuid><name>Nginx: Requests</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.requests.total.rate</key></item></graph_item></graph_items></graph><graph><uuid>b1c647610c974bc8aad4fb55e1e3c8d3</uuid><name>Nginx: SSL</name><graph_items><graph_item><drawtype>GRADIENT_LINE</drawtype><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.ssl.handshakes.rate</key></item></graph_item><graph_item><sortorder>1</sortorder><drawtype>GRADIENT_LINE</drawtype><color>2774A4</color><item><host>Nginx Plus by HTTP</host><key>nginx.ssl.handshakes_failed.rate</key></item></graph_item><graph_item><sortorder>2</sortorder><drawtype>GRADIENT_LINE</drawtype><color>F63100</color><item><host>Nginx Plus by HTTP</host><key>nginx.ssl.session_reuses.rate</key></item></graph_item></graph_items></graph><graph><uuid>b2da29d4951745db8a66a076eb99d0aa</uuid><name>Nginx: Uptime</name><graph_items><graph_item><color>1A7C11</color><item><host>Nginx Plus by HTTP</host><key>nginx.info.uptime</key></item></graph_item></graph_items></graph></graphs></zabbix_export>
